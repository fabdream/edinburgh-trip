<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√âdimbourg en Famille ‚Äî F√©vrier 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=Caveat:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<style>
:root {
  --navy: #1a1f3a;
  --royal: #2d3561;
  --gold: #d4a853;
  --gold-light: #f0d68a;
  --cream: #faf6ee;
  --stone: #e8e0d0;
  --green: #3d6b4f;
  --green-light: #5a9e6f;
  --rust: #c4653a;
  --sky: #6ba3be;
  --white: #ffffff;
  --text: #2c2c2c;
  --text-light: #6b6b6b;
  --shadow: 0 4px 20px rgba(0,0,0,0.1);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.15);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Inter', sans-serif;
  color: var(--text);
  background: var(--cream);
  overflow-x: hidden;
}

/* ===== HERO ===== */
.hero {
  position: relative;
  height: 100vh;
  min-height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.hero-bg {
  position: absolute;
  inset: 0;
  background: url('hero-bg.jpg') center/cover no-repeat;
  filter: brightness(0.55);
  transform: scale(1.1);
  animation: heroZoom 20s ease-in-out infinite alternate;
}

@keyframes heroZoom {
  from { transform: scale(1.1); }
  to { transform: scale(1.2); }
}

.hero-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(26,31,58,0.3) 0%, rgba(26,31,58,0.7) 100%);
}

.hero-content {
  position: relative;
  z-index: 2;
  text-align: center;
  color: white;
  padding: 0 20px;
  animation: fadeUp 1.2s ease-out;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

.hero-flag {
  font-size: 3rem;
  margin-bottom: 16px;
  animation: wave 2s ease-in-out infinite;
}

@keyframes wave {
  0%, 100% { transform: rotate(-5deg); }
  50% { transform: rotate(5deg); }
}

.hero h1 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2.5rem, 7vw, 5rem);
  font-weight: 700;
  letter-spacing: -1px;
  margin-bottom: 12px;
  text-shadow: 0 2px 20px rgba(0,0,0,0.3);
}

.hero h1 span {
  color: var(--gold-light);
}

.hero-subtitle {
  font-family: 'Caveat', cursive;
  font-size: clamp(1.3rem, 3vw, 2rem);
  color: var(--gold-light);
  margin-bottom: 24px;
}

.hero-dates {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 50px;
  padding: 12px 28px;
  font-size: 1rem;
  font-weight: 500;
  margin-bottom: 32px;
}

.hero-scroll {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
  color: white;
  text-align: center;
  animation: bounce 2s infinite;
  cursor: pointer;
  text-decoration: none;
}

.hero-scroll span {
  display: block;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
  opacity: 0.8;
}

@keyframes bounce {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(10px); }
}

.scroll-arrow {
  width: 24px;
  height: 24px;
  border-right: 2px solid white;
  border-bottom: 2px solid white;
  transform: rotate(45deg);
  margin: 0 auto;
  opacity: 0.7;
}

/* ===== NAVIGATION ===== */
.nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  padding: 16px 24px;
  display: flex;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
  transition: all 0.3s;
}

.nav.scrolled {
  background: rgba(26,31,58,0.95);
  backdrop-filter: blur(12px);
  box-shadow: var(--shadow);
  padding: 10px 24px;
}

.nav a {
  color: white;
  text-decoration: none;
  font-size: 0.8rem;
  font-weight: 500;
  padding: 6px 14px;
  border-radius: 20px;
  transition: all 0.3s;
  text-transform: uppercase;
  letter-spacing: 1px;
  white-space: nowrap;
}

.nav a:hover, .nav a.active {
  background: var(--gold);
  color: var(--navy);
}

/* ===== SECTIONS ===== */
section {
  padding: 80px 20px;
}

.container {
  max-width: 1100px;
  margin: 0 auto;
}

.section-label {
  font-family: 'Caveat', cursive;
  font-size: 1.2rem;
  color: var(--gold);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
}

.section-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2rem, 4vw, 3rem);
  color: var(--navy);
  margin-bottom: 16px;
}

.section-desc {
  font-size: 1.1rem;
  color: var(--text-light);
  max-width: 700px;
  line-height: 1.7;
}

/* ===== FLIGHT CARDS ===== */
#vols { background: var(--navy); }

.flights-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
  margin-top: 40px;
}

.flight-card {
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 20px;
  padding: 32px;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s;
}

.flight-card:hover { transform: translateY(-4px); }

.flight-card::before {
  content: '';
  position: absolute;
  top: -2px;
  left: 20%;
  right: 20%;
  height: 3px;
  background: linear-gradient(90deg, var(--gold), var(--gold-light));
  border-radius: 0 0 4px 4px;
}

.flight-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: var(--gold-light);
  margin-bottom: 20px;
}

.flight-route {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 24px;
}

.flight-city {
  text-align: center;
}

.flight-code {
  font-size: 2rem;
  font-weight: 700;
  color: white;
}

.flight-name {
  font-size: 0.85rem;
  color: rgba(255,255,255,0.6);
  margin-top: 4px;
}

.flight-plane {
  font-size: 1.5rem;
  color: var(--gold);
  position: relative;
}

.flight-plane::before, .flight-plane::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 40px;
  height: 1px;
  background: rgba(255,255,255,0.2);
}

.flight-plane::before { right: 100%; margin-right: 8px; }
.flight-plane::after { left: 100%; margin-left: 8px; }

.flight-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.flight-detail {
  background: rgba(255,255,255,0.05);
  padding: 10px 14px;
  border-radius: 10px;
}

.flight-detail-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.4);
  margin-bottom: 4px;
}

.flight-detail-value {
  font-size: 1rem;
  font-weight: 600;
  color: white;
}

/* ===== HOTEL MAP ===== */
#hotel { background: var(--cream); }

.hotel-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 32px;
  margin-top: 40px;
  align-items: start;
}

@media (max-width: 768px) {
  .hotel-grid { grid-template-columns: 1fr; }
}

.hotel-info-card {
  background: white;
  border-radius: 20px;
  padding: 32px;
  box-shadow: var(--shadow);
}

.hotel-address {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--navy);
  margin-bottom: 8px;
}

.hotel-neighborhood {
  color: var(--gold);
  font-weight: 500;
  margin-bottom: 20px;
}

.hotel-features {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.hotel-features li {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-size: 0.95rem;
  line-height: 1.5;
  color: var(--text-light);
}

.hotel-features li .icon {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  background: var(--cream);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
}

.map-container {
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  height: 400px;
}

.map-container iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* ===== TRANSPORT ===== */
#transport { background: white; }

.transport-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  margin-top: 40px;
}

.transport-card {
  border: 2px solid var(--stone);
  border-radius: 20px;
  padding: 28px;
  transition: all 0.3s;
  position: relative;
}

.transport-card:hover {
  border-color: var(--gold);
  transform: translateY(-4px);
  box-shadow: var(--shadow);
}

.transport-card.recommended {
  border-color: var(--gold);
  background: linear-gradient(135deg, rgba(212,168,83,0.05), rgba(212,168,83,0.1));
}

.transport-card.recommended::after {
  content: '‚òÖ Recommand√©';
  position: absolute;
  top: -12px;
  right: 20px;
  background: var(--gold);
  color: var(--navy);
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 4px 12px;
  border-radius: 20px;
}

.transport-icon {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  margin-bottom: 16px;
}

.transport-card:nth-child(1) .transport-icon { background: #fff3cd; }
.transport-card:nth-child(2) .transport-icon { background: #d4edda; }
.transport-card:nth-child(3) .transport-icon { background: #cce5ff; }

.transport-card h3 {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--navy);
  margin-bottom: 12px;
}

.transport-card p {
  font-size: 0.9rem;
  color: var(--text-light);
  line-height: 1.6;
  margin-bottom: 16px;
}

.transport-stat {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.transport-stat-item {
  background: var(--cream);
  padding: 8px 14px;
  border-radius: 10px;
  font-size: 0.8rem;
}

.transport-stat-item strong {
  display: block;
  font-size: 1rem;
  color: var(--navy);
}

.transport-tips {
  margin-top: 40px;
  background: linear-gradient(135deg, var(--navy), var(--royal));
  border-radius: 20px;
  padding: 32px;
  color: white;
}

.transport-tips h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem;
  margin-bottom: 16px;
  color: var(--gold-light);
}

.transport-tips ul {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.transport-tips li {
  padding-left: 24px;
  position: relative;
  line-height: 1.6;
  font-size: 0.95rem;
  color: rgba(255,255,255,0.85);
}

.transport-tips li::before {
  content: '‚Üí';
  position: absolute;
  left: 0;
  color: var(--gold);
  font-weight: 700;
}

/* ===== TIMELINE / ITINERARY ===== */
#itineraire { background: var(--cream); }

.day-cards {
  display: flex;
  flex-direction: column;
  gap: 32px;
  margin-top: 48px;
}

.day-card {
  background: white;
  border-radius: 24px;
  overflow: hidden;
  box-shadow: var(--shadow);
  transition: all 0.3s;
}

.day-card:hover {
  box-shadow: var(--shadow-lg);
}

.day-header {
  display: flex;
  align-items: stretch;
  cursor: pointer;
  position: relative;
}

.day-number {
  flex-shrink: 0;
  width: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px 16px;
  color: white;
  text-align: center;
}

.day-num {
  font-family: 'Playfair Display', serif;
  font-size: 2.4rem;
  font-weight: 700;
  line-height: 1;
}

.day-weekday {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  opacity: 0.8;
  margin-top: 4px;
}

.day-card:nth-child(1) .day-number { background: var(--royal); }
.day-card:nth-child(2) .day-number { background: var(--rust); }
.day-card:nth-child(3) .day-number { background: var(--green); }
.day-card:nth-child(4) .day-number { background: var(--sky); }
.day-card:nth-child(5) .day-number { background: var(--gold); color: var(--navy); }
.day-card:nth-child(6) .day-number { background: var(--navy); }

.day-summary {
  flex: 1;
  padding: 24px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.day-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem;
  color: var(--navy);
  margin-bottom: 6px;
}

.day-tagline {
  font-size: 0.9rem;
  color: var(--text-light);
}

.day-toggle {
  flex-shrink: 0;
  width: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  color: var(--text-light);
  transition: transform 0.3s;
}

.day-card.open .day-toggle { transform: rotate(180deg); }

.day-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease-in-out;
}

.day-card.open .day-body {
  max-height: 3000px;
}

.day-content {
  padding: 0 32px 32px;
}

.activity {
  padding: 20px 0;
  border-bottom: 1px solid var(--stone);
  display: grid;
  grid-template-columns: 100px 1fr;
  gap: 20px;
  align-items: start;
}

.activity:last-child { border-bottom: none; }

@media (max-width: 600px) {
  .activity { grid-template-columns: 1fr; gap: 8px; }
}

.activity-time {
  font-weight: 600;
  color: var(--navy);
  font-size: 0.85rem;
  padding-top: 2px;
  white-space: nowrap;
}

.activity-info h4 {
  font-size: 1.05rem;
  color: var(--navy);
  margin-bottom: 6px;
}

.activity-info p {
  font-size: 0.9rem;
  color: var(--text-light);
  line-height: 1.6;
}

.activity-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}

.tag {
  font-size: 0.7rem;
  padding: 3px 10px;
  border-radius: 20px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tag-walk { background: #d4edda; color: #155724; }
.tag-taxi { background: #fff3cd; color: #856404; }
.tag-free { background: #cce5ff; color: #004085; }
.tag-food { background: #f8d7da; color: #721c24; }
.tag-baby { background: #e2d9f3; color: #4a2d7a; }
.tag-must { background: var(--gold); color: var(--navy); }
.tag-paid { background: #fce4ec; color: #880e4f; }
.tag-rain { background: #b3e5fc; color: #01579b; }

.day-map {
  margin-top: 20px;
  border-radius: 16px;
  overflow: hidden;
  height: 300px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
}

.day-map iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* ===== IMAGE GALLERY ===== */
.gallery-strip {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 4px;
  margin: 60px 0 0;
  border-radius: 20px;
  overflow: hidden;
}

@media (max-width: 600px) {
  .gallery-strip { grid-template-columns: repeat(2, 1fr); }
}

.gallery-img {
  aspect-ratio: 1;
  object-fit: cover;
  width: 100%;
  transition: transform 0.5s;
}

.gallery-img:hover {
  transform: scale(1.08);
}

/* ===== RESTAURANTS ===== */
#restos { background: white; }

.resto-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.resto-card {
  background: var(--cream);
  border-radius: 16px;
  padding: 24px;
  transition: all 0.3s;
  border-left: 4px solid var(--gold);
}

.resto-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow);
}

.resto-card h3 {
  font-size: 1.1rem;
  color: var(--navy);
  margin-bottom: 4px;
}

.resto-location {
  font-size: 0.8rem;
  color: var(--gold);
  font-weight: 600;
  margin-bottom: 10px;
}

.resto-card p {
  font-size: 0.9rem;
  color: var(--text-light);
  line-height: 1.5;
}

/* ===== TIPS ===== */
#tips { background: linear-gradient(135deg, var(--navy) 0%, #2a3a6a 100%); color: white; }

#tips .section-label { color: var(--gold-light); }
#tips .section-title { color: white; }
#tips .section-desc { color: rgba(255,255,255,0.7); }

.tips-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.tip-card {
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 24px;
  transition: all 0.3s;
}

.tip-card:hover {
  background: rgba(255,255,255,0.12);
  transform: translateY(-4px);
}

.tip-icon {
  font-size: 2rem;
  margin-bottom: 12px;
}

.tip-card h3 {
  font-size: 1rem;
  margin-bottom: 8px;
  color: var(--gold-light);
}

.tip-card p {
  font-size: 0.85rem;
  color: rgba(255,255,255,0.7);
  line-height: 1.6;
}

/* ===== PACKING ===== */
#valise { background: var(--cream); }

.packing-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.packing-category {
  background: white;
  border-radius: 16px;
  padding: 24px;
  box-shadow: var(--shadow);
}

.packing-category h3 {
  font-size: 1rem;
  color: var(--navy);
  margin-bottom: 14px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--stone);
}

.packing-category ul {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.packing-category li {
  font-size: 0.9rem;
  color: var(--text-light);
  padding-left: 22px;
  position: relative;
}

.packing-category li::before {
  content: '‚òê';
  position: absolute;
  left: 0;
  color: var(--gold);
}

/* ===== FOOTER ===== */
footer {
  background: var(--navy);
  color: rgba(255,255,255,0.6);
  text-align: center;
  padding: 40px 20px;
}

footer .heart { color: var(--rust); }

footer p {
  font-size: 0.85rem;
  line-height: 1.8;
}

.footer-flag {
  font-size: 3rem;
  margin-bottom: 12px;
}

/* ===== SCROLL ANIMATIONS ===== */
.reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.7s ease-out;
}

.reveal.visible {
  opacity: 1;
  transform: translateY(0);
}

/* ===== AI ADAPT FEATURE ===== */
.adapt-btn {
  flex-shrink: 0;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 20px;
  font-size: 0.72rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  margin: auto 8px;
  white-space: nowrap;
  transition: all 0.25s;
  font-family: 'Inter', sans-serif;
}

.adapt-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 4px 16px rgba(102, 126, 234, 0.5);
}

.activity-maps-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: linear-gradient(135deg, #3d6b4f, #5a9e6f);
  color: white;
  text-decoration: none;
  padding: 4px 10px;
  border-radius: 8px;
  font-size: 0.75rem;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  transition: all 0.2s;
  margin-top: 8px;
  box-shadow: 0 1px 4px rgba(61,107,79,0.25);
}
.activity-maps-btn:active { transform: scale(0.96); }
.inline-maps-btn {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  background: linear-gradient(135deg, #3d6b4f, #5a9e6f);
  color: white;
  text-decoration: none;
  padding: 2px 7px;
  border-radius: 6px;
  font-size: 0.65rem;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  margin-left: 4px;
  vertical-align: middle;
  box-shadow: 0 1px 3px rgba(61,107,79,0.2);
  transition: all 0.2s;
}
.inline-maps-btn:active { transform: scale(0.96); }

/* ===== EXPLORER TOOL ===== */
.explorer-fab {
  position: fixed;
  bottom: 90px;
  right: 24px;
  z-index: 200;
  background: linear-gradient(135deg, #3d6b4f, #2a8a5a);
  color: white;
  border: 2px solid rgba(255,255,255,0.2);
  padding: 12px 20px;
  border-radius: 50px;
  font-size: 0.85rem;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(61,107,79,0.45);
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Inter', sans-serif;
  transition: all 0.3s;
  white-space: nowrap;
}
.explorer-fab:active { transform: scale(0.95); }

.explorer-overlay {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: var(--cream);
  flex-direction: column;
  overflow: hidden;
}
.explorer-overlay.open { display: flex; }

.explorer-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--navy);
  color: white;
  flex-shrink: 0;
}
.explorer-header h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  margin: 0;
}
.explorer-close {
  background: rgba(255,255,255,0.15);
  border: none;
  color: white;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.explorer-map-container {
  height: 40vh;
  min-height: 200px;
  flex-shrink: 0;
  position: relative;
}
#explorerMap { width: 100%; height: 100%; }

.explorer-gps-btn {
  position: absolute;
  bottom: 12px;
  right: 12px;
  z-index: 500;
  background: white;
  border: 2px solid var(--stone);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.1rem;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  justify-content: center;
}
.explorer-gps-btn.active { border-color: #3d6b4f; background: #eef7f1; }

.explorer-filters {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  overflow-x: auto;
  flex-shrink: 0;
  background: white;
  border-bottom: 1px solid var(--stone);
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.explorer-filters::-webkit-scrollbar { display: none; }

.explorer-filter-pill {
  background: var(--cream);
  border: 1.5px solid var(--stone);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  font-family: 'Inter', sans-serif;
  transition: all 0.2s;
  color: var(--navy);
}
.explorer-filter-pill.active {
  background: var(--navy);
  color: white;
  border-color: var(--navy);
}

.explorer-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  background: white;
  font-size: 0.78rem;
  color: var(--text-light);
  flex-shrink: 0;
}
.explorer-sort {
  display: flex;
  gap: 6px;
}
.explorer-sort button {
  background: none;
  border: 1px solid var(--stone);
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.72rem;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  color: var(--text-light);
}
.explorer-sort button.active {
  background: var(--gold);
  color: var(--navy);
  border-color: var(--gold);
  font-weight: 600;
}

.explorer-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px 12px 80px;
  -webkit-overflow-scrolling: touch;
}

.explorer-card {
  background: white;
  border-radius: 14px;
  padding: 14px 16px;
  margin-bottom: 10px;
  box-shadow: 0 1px 6px rgba(0,0,0,0.06);
  border: 1.5px solid transparent;
  cursor: pointer;
  transition: all 0.2s;
}
.explorer-card:active { transform: scale(0.985); }
.explorer-card.highlighted {
  border-color: var(--gold);
  box-shadow: 0 2px 12px rgba(212,168,83,0.3);
}

.explorer-card-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
}
.explorer-card-emoji {
  font-size: 1.5rem;
  flex-shrink: 0;
  line-height: 1;
}
.explorer-card-info { flex: 1; min-width: 0; }
.explorer-card-name {
  font-weight: 700;
  font-size: 0.92rem;
  color: var(--navy);
  margin-bottom: 3px;
}
.explorer-card-desc {
  font-size: 0.8rem;
  color: var(--text-light);
  line-height: 1.4;
}
.explorer-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
  text-align: right;
}
.explorer-card-dist {
  font-size: 0.75rem;
  font-weight: 700;
  color: #3d6b4f;
  white-space: nowrap;
}
.explorer-card-price {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--gold);
  background: #fdf6e3;
  padding: 2px 8px;
  border-radius: 8px;
  white-space: nowrap;
}

.explorer-card-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-top: 8px;
}
.explorer-tag {
  font-size: 0.68rem;
  padding: 2px 8px;
  border-radius: 8px;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
}
.explorer-tag-indoor { background: #e8f4fd; color: #2563eb; }
.explorer-tag-outdoor { background: #ecfdf5; color: #059669; }
.explorer-tag-free { background: #f0fdf4; color: #16a34a; }
.explorer-tag-baby-top { background: #fef3c7; color: #d97706; }
.explorer-tag-baby-ok { background: #f3f4f6; color: #6b7280; }

.explorer-card-actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}
.explorer-maps-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: linear-gradient(135deg, #3d6b4f, #5a9e6f);
  color: white;
  text-decoration: none;
  padding: 5px 12px;
  border-radius: 10px;
  font-size: 0.72rem;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
}

.explorer-empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-light);
  font-size: 0.9rem;
}

@media (max-width: 600px) {
  .explorer-fab { bottom: 80px; right: 16px; padding: 10px 16px; font-size: 0.8rem; }
  .explorer-map-container { height: 35vh; min-height: 180px; }
  .explorer-card { padding: 12px; }
}

.adapt-modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(6px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.adapt-modal-overlay.open { display: flex; }

.adapt-modal {
  background: white;
  border-radius: 24px;
  padding: 32px;
  width: 100%;
  max-width: 480px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalIn 0.3s ease-out;
}

@keyframes modalIn {
  from { opacity: 0; transform: translateY(20px) scale(0.97); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.adapt-modal-header h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem;
  color: var(--navy);
  margin-bottom: 4px;
}

.adapt-modal-subtitle {
  font-size: 0.9rem;
  color: var(--text-light);
  margin-bottom: 24px;
  font-style: italic;
}

.adapt-field { margin-bottom: 20px; }

.adapt-field label {
  display: block;
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--navy);
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.8px;
}

.adapt-field input[type="time"] {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--stone);
  border-radius: 12px;
  font-size: 1.1rem;
  font-family: 'Inter', sans-serif;
  color: var(--navy);
  background: var(--cream);
  outline: none;
  transition: border-color 0.2s;
}

.adapt-field input[type="time"]:focus { border-color: #667eea; }

.adapt-options { display: flex; gap: 8px; }

.adapt-option {
  flex: 1;
  padding: 10px 8px;
  border: 2px solid var(--stone);
  border-radius: 12px;
  background: var(--cream);
  font-size: 0.82rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  text-align: center;
}

.adapt-option:hover { border-color: #667eea; background: white; }

.adapt-option.active {
  border-color: #667eea;
  background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
  color: #5a67d8;
  font-weight: 700;
}

.adapt-modal-footer {
  display: flex;
  gap: 12px;
  margin-top: 28px;
}

.adapt-cancel {
  padding: 12px 20px;
  border: 2px solid var(--stone);
  border-radius: 12px;
  background: white;
  font-family: 'Inter', sans-serif;
  font-size: 0.9rem;
  cursor: pointer;
  color: var(--text-light);
  transition: all 0.2s;
}

.adapt-cancel:hover { border-color: var(--text-light); }

.adapt-generate {
  flex: 1;
  padding: 12px 20px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  border-radius: 12px;
  font-family: 'Inter', sans-serif;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}

.adapt-generate:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(102,126,234,0.4); }
.adapt-generate:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

.ai-result {
  display: none;
  margin: 0 32px 32px;
  background: linear-gradient(135deg, #f5f3ff, #ede9fe);
  border: 2px solid rgba(102, 126, 234, 0.25);
  border-radius: 20px;
  overflow: hidden;
}

.ai-result.visible { display: block; }

.ai-result-header {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 16px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.ai-result-header h4 {
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  font-weight: 600;
}

.ai-result-meta { font-size: 0.75rem; opacity: 0.8; margin-top: 2px; }

.ai-result-close {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 5px 12px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.75rem;
  font-family: 'Inter', sans-serif;
  transition: background 0.2s;
  flex-shrink: 0;
}

.ai-result-close:hover { background: rgba(255,255,255,0.35); }

.ai-result-body { padding: 20px 24px; }

.ai-activity {
  padding: 16px 0;
  border-bottom: 1px solid rgba(102, 126, 234, 0.15);
  display: grid;
  grid-template-columns: 80px 1fr;
  gap: 16px;
  align-items: start;
}

.ai-activity:last-child { border-bottom: none; }

.ai-activity-time {
  font-weight: 700;
  color: #5a67d8;
  font-size: 0.85rem;
  padding-top: 2px;
}

.ai-activity-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--navy);
  margin-bottom: 4px;
}

.ai-activity-desc {
  font-size: 0.88rem;
  color: var(--text-light);
  line-height: 1.5;
}

.ai-activity-conseil {
  font-size: 0.8rem;
  color: #5a67d8;
  font-style: italic;
  margin-top: 5px;
}

.adapt-loading {
  text-align: center;
  padding: 36px;
  color: #667eea;
}

.adapt-loading-spinner {
  width: 36px;
  height: 36px;
  border: 3px solid rgba(102, 126, 234, 0.2);
  border-top: 3px solid #667eea;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin { to { transform: rotate(360deg); } }

@media (max-width: 600px) {
  .adapt-btn { padding: 6px 10px; font-size: 0.68rem; margin: auto 4px; }
  .ai-result { margin: 0 16px 24px; }
  .ai-activity { grid-template-columns: 68px 1fr; }
}

/* ===== QUE FAIRE FEATURE ===== */
.qf-fab {
  position: fixed;
  bottom: 28px;
  right: 24px;
  z-index: 200;
  background: linear-gradient(135deg, var(--royal), var(--navy));
  color: white;
  border: 2px solid rgba(255,255,255,0.15);
  padding: 13px 22px;
  border-radius: 50px;
  font-size: 0.88rem;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(26,31,58,0.45);
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s;
  font-family: 'Inter', sans-serif;
}

.qf-fab:hover { transform: translateY(-3px); box-shadow: 0 10px 32px rgba(26,31,58,0.55); }

.qf-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 299;
  backdrop-filter: blur(4px);
}

.qf-overlay.open { display: block; }

.qf-panel {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 300;
  background: white;
  border-radius: 24px 24px 0 0;
  box-shadow: 0 -8px 40px rgba(0,0,0,0.2);
  max-height: 88vh;
  overflow-y: auto;
  transform: translateY(100%);
  transition: transform 0.38s cubic-bezier(0.34, 1.15, 0.64, 1);
  padding-bottom: 24px;
}

.qf-panel.open { transform: translateY(0); }

.qf-handle { width: 40px; height: 4px; background: var(--stone); border-radius: 4px; margin: 12px auto 0; }

.qf-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 22px 0;
}

.qf-panel-header h3 { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--navy); }

.qf-close {
  background: var(--stone);
  border: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-light);
  transition: all 0.2s;
  flex-shrink: 0;
}

.qf-close:hover { background: var(--text-light); color: white; }

.qf-main-choices {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 16px 20px 0;
}

.qf-choice {
  padding: 16px 6px;
  border: 2px solid var(--stone);
  border-radius: 16px;
  background: var(--cream);
  cursor: pointer;
  text-align: center;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text);
  font-family: 'Inter', sans-serif;
  transition: all 0.2s;
  line-height: 1.5;
}

.qf-choice:hover { border-color: var(--gold); }
.qf-choice-icon { font-size: 1.5rem; display: block; margin-bottom: 5px; }
.qf-choice.active { border-color: var(--navy); background: var(--navy); color: white; box-shadow: 0 4px 12px rgba(26,31,58,0.28); }

.qf-specific-inner { padding: 0 20px; }

.qf-field { margin-top: 16px; }

.qf-field label {
  display: block;
  font-size: 0.73rem;
  font-weight: 700;
  color: var(--text-light);
  text-transform: uppercase;
  letter-spacing: 0.9px;
  margin-bottom: 8px;
}

.qf-options { display: flex; flex-wrap: wrap; gap: 6px; }

.qf-opt {
  padding: 7px 13px;
  border: 2px solid var(--stone);
  border-radius: 20px;
  background: white;
  font-size: 0.8rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.18s;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  white-space: nowrap;
}

.qf-opt:hover { border-color: var(--gold); }
.qf-opt.active { border-color: var(--navy); background: var(--navy); color: white; font-weight: 600; }

.qf-context { display: none; margin: 16px 20px 0; padding: 16px 0 0; border-top: 1px solid var(--stone); }
.qf-context.visible { display: block; }

.qf-context-inline { display: flex; gap: 20px; }
.qf-context-inline .qf-field { flex: 1; }

.qf-cta-wrap { display: none; padding: 18px 20px 0; }
.qf-cta-wrap.visible { display: block; }

.qf-cta-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, var(--royal), var(--navy));
  color: white;
  border: none;
  border-radius: 16px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  transition: all 0.25s;
}

.qf-cta-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(26,31,58,0.35); }
.qf-cta-btn:disabled { opacity: 0.65; cursor: not-allowed; transform: none; }

.qf-results { padding: 0 20px 24px; }

.qf-results-header { font-size: 0.73rem; font-weight: 700; color: var(--text-light); text-transform: uppercase; letter-spacing: 1.2px; padding: 20px 0 10px; }

.qf-suggestion {
  background: var(--cream);
  border: 1px solid var(--stone);
  border-radius: 18px;
  padding: 18px;
  margin-bottom: 12px;
  border-left: 4px solid var(--gold);
  animation: fadeUp 0.35s ease-out both;
}

.qf-sug-top { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 10px; }
.qf-sug-emoji { font-size: 1.7rem; flex-shrink: 0; line-height: 1; margin-top: 2px; }
.qf-sug-name { font-size: 1.02rem; font-weight: 700; color: var(--navy); margin-bottom: 3px; }
.qf-sug-badge { font-size: 0.75rem; font-weight: 600; color: var(--gold); }
.qf-sug-pourquoi { font-size: 0.88rem; color: var(--text); line-height: 1.55; margin-bottom: 8px; }
.qf-sug-detail { font-size: 0.82rem; color: var(--text-light); margin-bottom: 10px; font-style: italic; }
.qf-sug-footer { display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.78rem; color: var(--text-light); border-top: 1px solid var(--stone); padding-top: 10px; }

.qf-loading { text-align: center; padding: 32px 20px; color: var(--text-light); }
.qf-spinner { width: 32px; height: 32px; border: 3px solid var(--stone); border-top: 3px solid var(--navy); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 14px; }
.qf-error { padding: 16px; background: #fff5f5; border-radius: 12px; color: #c53030; font-size: 0.88rem; margin-top: 16px; }

/* ===== LEAFLET MAPS ===== */
.qf-map-container { height: 280px; border-radius: 16px; margin: 16px 0 8px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.1); position: relative; z-index: 1; }
.day-leaflet-map { width: 100%; height: 100%; }
.custom-pin { background: transparent !important; border: none !important; }
.map-pin { display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 700; box-shadow: 0 3px 10px rgba(0,0,0,0.35); text-align: center; line-height: 1; }
.map-pin-hotel { width: 44px; height: 44px; background: var(--gold); font-size: 1.3rem; border: 3px solid white; }
.map-pin-suggestion { width: 38px; height: 38px; background: var(--navy); color: white; font-size: 1rem; border: 3px solid white; }
.map-pin-landmark { width: 36px; height: 36px; background: white; font-size: 1rem; border: 3px solid var(--stone); }
.map-pin-day { width: 34px; height: 34px; background: var(--royal); color: white; font-size: 0.9rem; border: 3px solid white; }
.map-pin-alt { width: 28px; height: 28px; background: var(--stone); color: var(--text-light); font-size: 0.85rem; border: 2px solid white; }
.map-popup { font-family: 'Inter', sans-serif; }
.map-popup strong { font-size: 0.9rem; color: var(--navy); }
.map-popup p { font-size: 0.78rem; color: var(--gold); margin: 4px 0 8px; }
.map-popup-nav { display: inline-block; background: #3d6b4f; color: white; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 0.78rem; font-weight: 600; }
.yaller-btn { display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg, #3d6b4f, #5a9e6f); color: white; text-decoration: none; padding: 10px 18px; border-radius: 12px; font-size: 0.88rem; font-weight: 700; font-family: 'Inter', sans-serif; transition: all 0.25s; box-shadow: 0 2px 8px rgba(61,107,79,0.3); }
.yaller-btn:active { transform: scale(0.97); }
.voir-autres-btn { background: white; border: 2px solid var(--stone); color: var(--text-light); padding: 8px 14px; border-radius: 12px; font-size: 0.82rem; font-weight: 600; cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.2s; }
.voir-autres-btn:active { border-color: var(--gold); color: var(--navy); }
.qf-geolocate { background: linear-gradient(135deg, #3d6b4f, #5a9e6f) !important; color: white !important; border-color: #3d6b4f !important; font-weight: 600; }
.qf-geolocate.loading { opacity: 0.7; pointer-events: none; }
.qf-geolocate.active { background: linear-gradient(135deg, #2d5a3f, #4a8e5f) !important; box-shadow: 0 0 0 2px var(--gold); }
.qf-sug-actions { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
.qf-map-container .leaflet-top, .qf-map-container .leaflet-bottom { z-index: 10 !important; }
.map-container .leaflet-top, .map-container .leaflet-bottom { z-index: 10 !important; }
.day-map .leaflet-top, .day-map .leaflet-bottom { z-index: 10 !important; }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  section { padding: 50px 16px; }
  .day-header { flex-wrap: wrap; }
  .day-number { width: 70px; }
  .day-content { padding: 0 20px 24px; }
  .hotel-grid { grid-template-columns: 1fr; }
  .flight-route { gap: 8px; }
  .flight-code { font-size: 1.5rem; }
}
</style>
</head>
<body>

<!-- NAVIGATION -->
<nav class="nav" id="mainNav">
  <a href="#vols">Vols</a>
  <a href="#hotel">H√¥tel</a>
  <a href="#transport">Transport</a>
  <a href="#itineraire">Itin√©raire</a>
  <a href="#restos">Restos</a>
  <a href="#tips">Tips</a>
  <a href="#valise">Valise</a>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bg"></div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <div class="hero-flag">üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø</div>
    <h1><span>√âdimbourg</span> en Famille</h1>
    <p class="hero-subtitle">Notre aventure √©cossaise avec b√©b√©</p>
    <div class="hero-dates">
      ‚úàÔ∏è &nbsp;20 ‚Äì 25 F√©vrier 2026 &nbsp;|&nbsp; 5 nuits
    </div>
  </div>
  <a href="#vols" class="hero-scroll">
    <span>D√©couvrir</span>
    <div class="scroll-arrow"></div>
  </a>
</section>

<!-- VOLS -->
<section id="vols">
  <div class="container">
    <p class="section-label" style="color: var(--gold-light);">‚úàÔ∏è Nos vols</p>
    <h2 class="section-title" style="color: white;">Gen√®ve ‚Üí √âdimbourg</h2>
    <p class="section-desc" style="color: rgba(255,255,255,0.6);">EasyJet ‚Äî vols directs, c'est parti pour l'√âcosse !</p>
    <div class="flights-grid">
      <!-- Aller -->
      <div class="flight-card reveal">
        <div class="flight-label">Aller ‚Äî Vendredi 20 F√©vrier</div>
        <div class="flight-route">
          <div class="flight-city">
            <div class="flight-code">GVA</div>
            <div class="flight-name">Gen√®ve</div>
          </div>
          <div class="flight-plane">‚úà</div>
          <div class="flight-city">
            <div class="flight-code">EDI</div>
            <div class="flight-name">√âdimbourg</div>
          </div>
        </div>
        <div class="flight-details">
          <div class="flight-detail">
            <div class="flight-detail-label">Vol</div>
            <div class="flight-detail-value">EZY 3296</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">D√©part</div>
            <div class="flight-detail-value">20h35</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">Gate closes</div>
            <div class="flight-detail-value">20h05</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">Arriv√©e ‚âà</div>
            <div class="flight-detail-value">21h30 üá¨üáß</div>
          </div>
        </div>
      </div>
      <!-- Retour -->
      <div class="flight-card reveal">
        <div class="flight-label">Retour ‚Äî Mercredi 25 F√©vrier</div>
        <div class="flight-route">
          <div class="flight-city">
            <div class="flight-code">EDI</div>
            <div class="flight-name">√âdimbourg</div>
          </div>
          <div class="flight-plane">‚úà</div>
          <div class="flight-city">
            <div class="flight-code">GVA</div>
            <div class="flight-name">Gen√®ve</div>
          </div>
        </div>
        <div class="flight-details">
          <div class="flight-detail">
            <div class="flight-detail-label">Vol</div>
            <div class="flight-detail-value">EZS 1562</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">D√©part</div>
            <div class="flight-detail-value">19h05</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">Gate closes</div>
            <div class="flight-detail-value">18h35</div>
          </div>
          <div class="flight-detail">
            <div class="flight-detail-label">Arriv√©e ‚âà</div>
            <div class="flight-detail-value">22h05 üá®üá≠</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- HOTEL -->
<section id="hotel">
  <div class="container">
    <p class="section-label">üè® Notre base</p>
    <h2 class="section-title">Destiny Scotland ‚Äî Hanover Apartments</h2>
    <p class="section-desc">Appart'h√¥tel id√©alement situ√© sur Hanover Street, tout est accessible √† pied. Princes Street, le ch√¢teau, le Royal Mile... tout est √† quelques minutes.</p>
    <div class="hotel-grid">
      <div class="hotel-info-card reveal">
        <div class="hotel-address">4 & 18 Hanover Street</div>
        <div class="hotel-neighborhood">Edinburgh EH2 2EN ‚Äî New Town</div>
        <ul class="hotel-features">
          <li><span class="icon">üè∞</span> Edinburgh Castle ‚Äî 10 min √† pied</li>
          <li><span class="icon">üõ§Ô∏è</span> Royal Mile ‚Äî 10 min √† pied</li>
          <li><span class="icon">üå≥</span> Princes Street Gardens ‚Äî 3 min √† pied</li>
          <li><span class="icon">üì∏</span> The Vennel (vue ch√¢teau iconique) ‚Äî 5 min √† pied</li>
          <li><span class="icon">üèõÔ∏è</span> National Museum ‚Äî 10 min √† pied</li>
          <li><span class="icon">üöã</span> Arr√™t tram St Andrew Sq. ‚Äî 2 min √† pied</li>
          <li><span class="icon">üèòÔ∏è</span> Dean Village ‚Äî 15 min √† pied</li>
          <li><span class="icon">üçΩÔ∏è</span> Restaurants sur Hanover Street m√™me !</li>
        </ul>
      </div>
      <div class="map-container reveal">
        <div id="hotelMap" style="width:100%;height:100%;"></div>
      </div>
    </div>
  </div>
</section>

<!-- TRANSPORT -->
<section id="transport">
  <div class="container">
    <p class="section-label">üöï Se d√©placer</p>
    <h2 class="section-title">Taxis, Tram & Transports</h2>
    <p class="section-desc">Avec un b√©b√© de 19 mois, le taxi est votre meilleur ami pour les longs trajets. Mais le centre-ville se fait tr√®s bien √† pied !</p>

    <div class="transport-grid">
      <div class="transport-card recommended reveal">
        <div class="transport-icon">üöï</div>
        <h3>Taxi ‚Äî Le plus pratique</h3>
        <p>Avec un toddler, les bagages, et la fatigue du voyage, le taxi est le choix le plus confortable. Les taxis noirs √©cossais (Hackney) sont spacieux et ont de la place pour la poussette dans le coffre.</p>
        <div class="transport-stat">
          <div class="transport-stat-item"><strong>¬£25‚Äì45</strong>A√©roport ‚Üí H√¥tel</div>
          <div class="transport-stat-item"><strong>25‚Äì35 min</strong>Dur√©e trajet</div>
        </div>
        <div style="margin-top: 16px; padding: 14px; background: #fff8e7; border-radius: 12px; font-size: 0.85rem; color: var(--text);">
          <strong>Comment prendre un taxi √† √âdimbourg :</strong><br><br>
          <strong>√Ä l'a√©roport :</strong> Sortez du terminal, la station de taxis est juste devant √† droite. Faites la queue, un dispatcher vous attribuera un taxi. Dites simplement ¬´ 4 Hanover Street, please ¬ª au chauffeur. Pas besoin de r√©server.<br><br>
          <strong>En ville :</strong> Levez la main quand vous voyez un taxi noir avec le voyant lumineux allum√© (= disponible). Vous pouvez aussi aller aux stations de taxi sur Princes Street, Waverley Bridge ou St Andrew Square.<br><br>
          <strong>Par t√©l√©phone :</strong> Appelez <strong>Central Taxis</strong> au <strong>0131 229 2468</strong> ou <strong>City Cabs</strong> au <strong>0131 228 1211</strong>. R√©servez 15‚Äì20 min √† l'avance.<br><br>
          <strong>Par app :</strong> T√©l√©chargez <strong>Free Now</strong> (anciennement mytaxi) ‚Äî √ßa fonctionne tr√®s bien √† √âdimbourg, comme un Uber mais avec les vrais taxis. Uber marche aussi.<br><br>
          <strong>Paiement :</strong> Tous les taxis acceptent la carte bancaire et le sans-contact. Pas besoin de cash. Le pourboire n'est pas obligatoire mais arrondir au ¬£ sup√©rieur est appr√©ci√©.
        </div>
      </div>
      <div class="transport-card reveal">
        <div class="transport-icon">üöã</div>
        <h3>Tram ‚Äî A√©roport direct</h3>
        <p>Le tram relie l'a√©roport au centre-ville (arr√™t St Andrew Square, √† 2 min de l'h√¥tel). Pratique pour le retour quand vous √™tes plus l√©gers.</p>
        <div class="transport-stat">
          <div class="transport-stat-item"><strong>¬£6.50</strong>Par adulte</div>
          <div class="transport-stat-item"><strong>~35 min</strong>Dur√©e</div>
          <div class="transport-stat-item"><strong>Gratuit</strong>Moins de 5 ans</div>
        </div>
        <div style="margin-top: 16px; padding: 14px; background: #e8f5e9; border-radius: 12px; font-size: 0.85rem; color: var(--text);">
          <strong>Astuce retour :</strong> Pour le vol retour du mercredi, prenez le tram depuis St Andrew Square (juste au bout de Hanover Street). C'est fiable, pas de risque d'embouteillage, et la poussette rentre facilement. Dernier tram vers l'a√©roport vers 22h45. Fr√©quence : toutes les 7‚Äì10 min.
        </div>
      </div>
      <div class="transport-card reveal">
        <div class="transport-icon">üö∂</div>
        <h3>√Ä pied ‚Äî La meilleure option</h3>
        <p>Gr√¢ce √† la position ultra-centrale de l'h√¥tel, 90% des activit√©s sont √† 15 min √† pied maximum. √âdimbourg est compacte et magnifique √† explorer √† pied.</p>
        <div class="transport-stat">
          <div class="transport-stat-item"><strong>Gratuit</strong>√âvidemment üòÑ</div>
          <div class="transport-stat-item"><strong>90%</strong>Du programme</div>
        </div>
        <div style="margin-top: 16px; padding: 14px; background: #e3f2fd; border-radius: 12px; font-size: 0.85rem; color: var(--text);">
          <strong>Attention :</strong> √âdimbourg = collines + pav√©s. Prenez une poussette compacte et solide. Pour le ch√¢teau et Calton Hill, un porte-b√©b√© est indispensable. Chaussures imperm√©ables fortement recommand√©es !
        </div>
      </div>
    </div>

    <div class="transport-tips reveal">
      <h3>üì± Apps √† t√©l√©charger avant de partir</h3>
      <ul>
        <li><strong>Free Now</strong> ‚Äî Pour commander un taxi en 2 clics (mieux qu'Uber √† √âdimbourg)</li>
        <li><strong>Uber</strong> ‚Äî Fonctionne aussi, en backup</li>
        <li><strong>Google Maps</strong> ‚Äî Indispensable pour les itin√©raires pi√©tons et les horaires de bus</li>
        <li><strong>Edinburgh Trams</strong> ‚Äî Horaires en temps r√©el du tram</li>
        <li><strong>Lothian Buses</strong> ‚Äî Si vous prenez le bus (n¬∞8 ou 23 pour le Botanic Garden par exemple), billet √† ¬£2 en sans-contact</li>
      </ul>
    </div>
  </div>
</section>

<!-- GALLERY STRIP -->
<div class="gallery-strip">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1567082904542-bd04c6be982c?w=500&q=80" alt="Victoria Street Edinburgh" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1557096002-7f215e6b5dcf?w=500&q=80" alt="Edinburgh Castle" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1546867043-73321b6fe9f3?w=500&q=80" alt="Edinburgh Old Town" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1565011231598-66c1ec39b72c?w=500&q=80" alt="Dean Village" loading="lazy">
</div>

<!-- ITINERAIRE -->
<section id="itineraire">
  <div class="container">
    <p class="section-label">üìÖ Jour par jour</p>
    <h2 class="section-title">Notre Itin√©raire</h2>
    <p class="section-desc">5 jours d'aventure √©cossaise, adapt√©s au rythme de b√©b√© avec des pauses sieste int√©gr√©es. Clique sur un jour pour voir le d√©tail !</p>

    <div class="day-cards">

      <!-- JOUR 1 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">20</div>
            <div class="day-weekday">Vendredi</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Arriv√©e √† √âdimbourg</div>
            <div class="day-tagline">Vol du soir, taxi jusqu'√† l'h√¥tel, premi√®re nuit en √âcosse</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">20h35</div>
              <div class="activity-info">
                <h4>‚úàÔ∏è D√©collage de Gen√®ve</h4>
                <p>Vol EasyJet EZY3296. Pensez √† √™tre √† la porte avant 20h05. Environ 2h de vol.</p>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">~21h30</div>
              <div class="activity-info">
                <h4>üõ¨ Arriv√©e √† √âdimbourg</h4>
                <p>Heure locale (‚àí1h par rapport √† la Suisse). R√©cup√©rez les bagages et direction la file de taxis devant le terminal. Dites ¬´ 4 Hanover Street, please ¬ª au chauffeur.</p>
                <div class="activity-tags">
                  <span class="tag tag-taxi">üöï Taxi ~¬£30</span>
                  <span class="tag tag-baby">üë∂ 30 min trajet</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">~22h15</div>
              <div class="activity-info">
                <h4>üè® Installation √† l'h√¥tel</h4>
                <p>Check-in, couchez la petite. Si vous avez un second souffle, George Street est √† 1 min ‚Äî magnifique de nuit avec les illuminations.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- JOUR 2 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">21</div>
            <div class="day-weekday">Samedi</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Old Town, Ch√¢teau & Royal Mile</div>
            <div class="day-tagline">Le gros morceau ! Ch√¢teau, Grassmarket, Victoria Street, Royal Mile</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">9h</div>
              <div class="activity-info">
                <h4>‚òï Petit-d√©j</h4>
                <p><strong>üè† √Ä l'appart</strong> ‚Äî faites vos courses la veille chez <strong>Marks & Spencer</strong> (Princes St, 3 min) ou <strong>Tesco Express</strong> (Nicolson St, 12 min). Croissants, fruits, yaourts, jus, caf√©. Tranquille et √©conomique !<br>
                <strong>Urban Angel</strong> (121 Hanover St, 0 min) ‚Äî si vous voulez sortir bruncher : brunch bio, avocado toast, smoothies.<br>
                <strong>Newtown Fox</strong> (2 Dundas St, 3 min) ‚Äî brunch all-day d√©contract√©, bon caf√©.</p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Appart ou dehors</span>
                  <span class="tag tag-walk">üö∂ 0‚Äì3 min</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üè∞ Edinburgh Castle</h4>
                <p>10 min √† pied depuis l'h√¥tel en remontant The Mound. Les Joyaux de la Couronne, la Pierre du Destin, les vues panoramiques depuis les remparts, le canon Mons Meg. Comptez 1h30‚Äì2h. Arrivez vers 10h pour √©viter la foule du midi.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">‚≠ê Incontournable</span>
                  <span class="tag tag-walk">üö∂ 10 min</span>
                  <span class="tag tag-paid">üí∑ ~¬£19.50/adulte</span>
                  <span class="tag tag-baby">üë∂ Porte-b√©b√© obligatoire</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">12h</div>
              <div class="activity-info">
                <h4>üçΩÔ∏è D√©jeuner ‚Äî Bertie's Fish & Chips</h4>
                <p>Redescendez vers Victoria Street (la rue color√©e !) et arr√™tez-vous chez Bertie's au n¬∞9 pour un vrai fish & chips √©cossais. Menu enfants, cuisine ouverte. Ou continuez au Grassmarket pour les pubs. <a href="tel:+441313221000" style="color:var(--gold);font-weight:600;">üìû 0131 322 1000</a></p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Fish & Chips</span>
                  <span class="tag tag-walk">üö∂ 5 min du ch√¢teau</span>
                  <span class="tag tag-baby">üë∂ Menu enfants</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">13h30</div>
              <div class="activity-info">
                <h4>üåà Victoria Street & Royal Mile</h4>
                <p>Victoria Street : la fameuse rue color√©e en courbe qui a inspir√© le Chemin de Traverse de Harry Potter ! Puis remontez le Royal Mile, explorez les ¬´ closes ¬ª (ruelles m√©di√©vales), go√ªtez du fudge et du shortbread.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">üì∏ Photo spot</span>
                  <span class="tag tag-walk">üö∂ √Ä pied</span>
                  <span class="tag tag-free">Gratuit</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">15h‚Äì17h</div>
              <div class="activity-info">
                <h4>üò¥ Sieste & repos √† l'h√¥tel</h4>
                <p>Retour tranquille (10 min √† pied). Sieste pour b√©b√©, th√© et repos pour les parents.</p>
                <div class="activity-tags"><span class="tag tag-baby">üë∂ Nap time</span></div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">19h</div>
              <div class="activity-info">
                <h4>üç¥ D√Æner ‚Äî Vittoria</h4>
                <p>Trattoria italienne familiale depuis 1970, au 19 George IV Bridge (10 min). Nappes √† carreaux, service chaleureux, pizzas et pastas g√©n√©reuses. Menu kids, crayons pour Giulia, chaises hautes. Z√©ro pr√©tention, beaucoup de saveur. <a href="tel:+441312251740" style="color:var(--gold);font-weight:600;">üìû 0131 225 1740</a></p>
                <div class="activity-tags"><span class="tag tag-food">üç¥ Italien familial</span><span class="tag tag-baby">üë∂ Menu kids + crayons</span></div>
              </div>
            </div>
            <div class="day-map">
              <div id="dayMap2" class="day-leaflet-map"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- JOUR 3 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">22</div>
            <div class="day-weekday">Dimanche</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Balade, Stockbridge & Spots Photos</div>
            <div class="day-tagline">Quartier boh√®me, architecture wow, canards ‚Äî au choix !</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">9h</div>
              <div class="activity-info">
                <h4>‚òï Petit-d√©j</h4>
                <p><strong>üè† √Ä l'appart</strong> ‚Äî petit-d√©j tranquille avec vos courses (M&S, Tesco). Rapide, √©conomique, Giulia mange √† son rythme.<br>
                <strong>The Pantry</strong> (1 NW Circus Pl, Stockbridge, 12 min) ‚Äî pancakes, eggs benedict, ambiance cozy. Id√©al si vous allez vers Stockbridge ensuite.<br>
                <strong>Loudon's Cafe</strong> (94b Fountainbridge, 15 min) ‚Äî bakery + aire de jeux enfants !</p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Appart ou dehors</span>
                  <span class="tag tag-baby">üë∂ Loudon's = aire de jeux</span>
                </div>
              </div>
            </div>
            <div style="background: #f0f7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
              <p style="font-weight: 600; color: var(--navy); margin-bottom: 8px;">ü§î Matin√©e : 3 options selon votre envie</p>
              <p style="font-size: 0.9rem; color: var(--text-light);">
                <strong>A.</strong> Dean Village + Stockbridge (balade, poussette OK)<br>
                <strong>B.</strong> Holyrood Park & Loch (nature, canards, grands espaces)<br>
                <strong>C.</strong> Camera Obscura (indoor, illusions interactives, fun)
              </p>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üèòÔ∏è Option A : Dean Village & Stockbridge</h4>
                <p>Village de meuniers au bord de la rivi√®re ‚Äî hors du temps. Puis suivez le Water of Leith Walkway vers Stockbridge (~20 min de marche plate, praticable en poussette). Quartier boh√®me avec boutiques et caf√©s. <em>Note : quelques passages pav√©s et escaliers ‚Äî porte-b√©b√© peut √™tre utile.</em></p>
                <div class="activity-tags">
                  <span class="tag tag-must">üíé P√©pite cach√©e</span>
                  <span class="tag tag-walk">üö∂ 15 min de l'h√¥tel</span>
                  <span class="tag tag-free">Gratuit</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>ü¶Ü Option B : Holyrood Park & St Margaret's Loch</h4>
                <p>Grand parc naturel au pied d'Arthur's Seat, 15 min √† pied ou 5 min en taxi. Le loch est magique : canards, cygnes, oies ‚Äî Giulia va adorer. Grandes pelouses pour courir, tr√®s plat autour du loch. Beaucoup plus adapt√© aux tout-petits que Dean Village.</p>
                <div class="activity-tags">
                  <span class="tag tag-baby">üë∂ Parfait toddler</span>
                  <span class="tag tag-walk">üö∂ 15 min</span>
                  <span class="tag tag-free">Gratuit</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üîÆ Option C : Camera Obscura & World of Illusions</h4>
                <p>En haut du Royal Mile, juste √† c√¥t√© du ch√¢teau. 5 √©tages d'illusions d'optique, miroirs d√©formants, lumi√®res et magie. Interactif et fascinant m√™me pour les petits. Id√©al si pluie ! ~¬£19.50/adulte, gratuit &lt;3 ans.</p>
                <div class="activity-tags">
                  <span class="tag tag-rain">‚òî Indoor</span>
                  <span class="tag tag-walk">üö∂ 10 min</span>
                  <span class="tag tag-paid">üí∑ ¬£19.50</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">12h</div>
              <div class="activity-info">
                <h4>üçΩÔ∏è D√©jeuner</h4>
                <p><strong>The Scran & Scallie</strong> (si Stockbridge) ‚Äî gastropub Tom Kitchin, salle de jeux pour Giulia ! <a href="tel:+441313326281" style="color:var(--gold);font-weight:600;">üìû 0131 332 6281</a><br>
                <strong>Civerinos</strong> (si Old Town) ‚Äî pizza NY √† la part, rapide, Victoria Street.<br>
                <strong>The Piemaker</strong> (si Royal Mile) ‚Äî pies √©cossaises √† ¬£4‚Äì7, simple et bon.</p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Selon votre option</span>
                  <span class="tag tag-baby">üë∂ Scran = salle de jeux</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">14h‚Äì15h</div>
              <div class="activity-info">
                <h4>üò¥ Sieste & repos</h4>
                <p>Retour √† l'h√¥tel (~10 min depuis Stockbridge). Pause bien m√©rit√©e.</p>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">15h30</div>
              <div class="activity-info">
                <h4>üì∏ Spots Photos & Architecture Wow</h4>
                <p>Encha√Ænez les p√©pites √† pied depuis l'h√¥tel ‚Äî tout est √† 5‚Äì10 min :<br>
                <strong>The Vennel</strong> ‚Äî escalier en pierre avec LA vue iconique sur le ch√¢teau. LE spot photo d'√âdimbourg, Giulia en √©charpe + ch√¢teau = photo parfaite.<br>
                <strong>Victoria Street</strong> ‚Äî rue color√©e en courbe qui a inspir√© le Chemin de Traverse (Harry Potter). Boutiques magiques, fa√ßades incroyables.<br>
                <strong>Greyfriars Bobby</strong> ‚Äî la statue du petit chien fid√®le, les enfants adorent ! Touchez son nez pour la chance. √Ä c√¥t√©, le cimeti√®re de Greyfriars est magnifique et paisible.<br>
                <strong>Grassmarket</strong> ‚Äî place anim√©e au pied du ch√¢teau, architecture typique, caf√©s, vue spectaculaire en levant les yeux.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">üì∏ Incontournable</span>
                  <span class="tag tag-walk">üö∂ 5‚Äì10 min</span>
                  <span class="tag tag-free">Gratuit</span>
                  <span class="tag tag-baby">üë∂ Wow garanti</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">17h30</div>
              <div class="activity-info">
                <h4>üåÖ Balade sur Princes Street</h4>
                <p>Le ch√¢teau illumin√© au coucher du soleil avec les jardins en contrebas ‚Äî c'est magique. C'est au bout de votre rue.</p>
                <div class="activity-tags"><span class="tag tag-must">üì∏ Sunset spot</span></div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">19h</div>
              <div class="activity-info">
                <h4>üè† Soir√©e √† l'appart ‚Äî D√Æner tranquille</h4>
                <p>Ce soir, profitez de votre appartement ! Giulia sera fatigu√©e, c'est le moment parfait pour une soir√©e cocooning.<br>
                <strong>Deliveroo / Uber Eats</strong> ‚Äî commandez directement depuis l'appli, large choix √† √âdimbourg (tha√Ø, indien, pizza, burgers‚Ä¶).<br>
                <strong>Bertie's Fish & Chips</strong> (Victoria St, 10 min) ‚Äî commandez √† emporter le meilleur fish & chips de la ville !<br>
                <strong>Civerinos Slice</strong> (Hunter Square, 10 min) ‚Äî pizza √† la part XXL √† emporter, rapide et d√©licieux.<br>
                <strong>Marks & Spencer</strong> (Princes St, 3 min) ‚Äî plats pr√©par√©s de qualit√©, snacks, vin, desserts. Le ¬´ Dine In for Two ¬ª est top.<br>
                <strong>Tesco Express</strong> (Nicolson St, 12 min) ‚Äî courses rapides si vous voulez cuisiner simple.</p>
                <div class="activity-tags">
                  <span class="tag tag-baby">üë∂ Parfait si fatigu√©e</span>
                  <span class="tag tag-food">üç¥ Takeaway & delivery</span>
                  <span class="tag tag-must">üõãÔ∏è Soir√©e cocooning</span>
                </div>
              </div>
            </div>
            <div class="day-map">
              <div id="dayMap3" class="day-leaflet-map"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- JOUR 4 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">23</div>
            <div class="day-weekday">Lundi</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Mus√©e National & Jardins</div>
            <div class="day-tagline">Dinosaures, sciences interactives, playground avec vue sur le ch√¢teau</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">9h</div>
              <div class="activity-info">
                <h4>‚òï Petit-d√©j</h4>
                <p><strong>üè† √Ä l'appart</strong> ‚Äî le plus simple avec une toddler ! Courses d√©j√† faites chez M&S ou Tesco.<br>
                <strong>Newtown Fox</strong> (2 Dundas St, 3 min) ‚Äî brunch all-day d√©contract√©, bon rapport qualit√©-prix.<br>
                <strong>Caf√© du National Museum</strong> ‚Äî si vous voulez encha√Æner direct avec la visite, le caf√© du mus√©e ouvre √† 10h.</p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Appart ou dehors</span>
                  <span class="tag tag-walk">üö∂ 0‚Äì3 min</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üèõÔ∏è National Museum of Scotland</h4>
                <p>LE spot avec un toddler ! Gratuit, accessible en poussette, tables √† langer, caf√©. Dinosaures, √©tage interactif des sciences (montgolfi√®re, mini voiture), animaux naturalis√©s. Expo ¬´ Giants ¬ª en cours ‚Äî fossiles grandeur nature. Facile d'y passer 2h.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">‚≠ê Top avec b√©b√©</span>
                  <span class="tag tag-free">Gratuit</span>
                  <span class="tag tag-walk">üö∂ 10 min</span>
                  <span class="tag tag-rain">‚òî Indoor</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">12h30</div>
              <div class="activity-info">
                <h4>üçΩÔ∏è D√©jeuner</h4>
                <p>Au caf√© du mus√©e ou sur Forrest Road / George IV Bridge pour plus d'options.</p>
                <div class="activity-tags"><span class="tag tag-food">üç¥ Options multiples</span></div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">14h30</div>
              <div class="activity-info">
                <h4>üå≥ Princes Street Gardens & Playground</h4>
                <p>Le grand parc entre New Town et Old Town avec le ch√¢teau en toile de fond. Aire de jeux c√¥t√© ouest, parfaite pour votre fille. Un des plus beaux panoramas d'√âdimbourg.</p>
                <div class="activity-tags">
                  <span class="tag tag-baby">üë∂ Playground</span>
                  <span class="tag tag-free">Gratuit</span>
                  <span class="tag tag-walk">üö∂ 3 min</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">16h30</div>
              <div class="activity-info">
                <h4>‚õ∞Ô∏è Calton Hill OU Mary's Milk Bar (optionnel)</h4>
                <p><strong>Si en forme :</strong> Calton Hill ‚Äî 15 min √† pied, mont√©e courte (~10 min), vue √† 360¬∞ spectaculaire. Porte-b√©b√© recommand√©.<br>
                <strong>Si fatigu√©s :</strong> Mary's Milk Bar (Grassmarket, 10 min) ‚Äî gelato artisanal et hot chocolate dans un cadre adorable. Giulia va adorer !<br>
                <strong>Alternative :</strong> Fl√¢ner sur Circus Lane √† Stockbridge (10 min) ‚Äî ruelle pav√©e ultra-instagrammable.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">üì∏ 3 options</span>
                  <span class="tag tag-walk">üö∂ 10‚Äì15 min</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">19h</div>
              <div class="activity-info">
                <h4>üç¥ D√Æner ‚Äî Mums ou Newtown Fox</h4>
                <p>Mums Great Comfort Food (4A Forrest Road, 12 min) : saucisses-pur√©e, mac & cheese, haggis, sticky toffee pudding ‚Äî menu kids, z√©ro chichi. Ou Newtown Fox (2 Dundas St, 3 min) : plus proche, brunch all-day d√©contract√©, super avec la petite. <a href="tel:+441312609806" style="color:var(--gold);font-weight:600;">üìû Mums 0131 260 9806</a></p>
                <div class="activity-tags"><span class="tag tag-food">üç¥ Comfort food</span><span class="tag tag-baby">üë∂ Kid-friendly</span></div>
              </div>
            </div>
            <div class="day-map">
              <div id="dayMap4" class="day-leaflet-map"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- JOUR 5 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">24</div>
            <div class="day-weekday">Mardi</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Aventure Indoor + Shopping</div>
            <div class="day-tagline">Activit√©s adapt√©es aux tout-petits, shopping & d√Æner d'anniversaire</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">9h</div>
              <div class="activity-info">
                <h4>‚òï Petit-d√©j</h4>
                <p><strong>üè† √Ä l'appart</strong> ‚Äî dernier petit-d√©j tranquille avant la journ√©e aventure.<br>
                <strong>Bread Meats Bread</strong> (1 Lothian Rd, 10 min) ‚Äî pour un brunch copieux, smash burgers d√®s le matin !<br>
                <strong>Urban Angel</strong> (121 Hanover St, 0 min) ‚Äî toujours l√† si vous voulez rester simple et proche.</p>
                <div class="activity-tags">
                  <span class="tag tag-food">üç¥ Appart ou dehors</span>
                </div>
              </div>
            </div>
            <div style="background: #f0f7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
              <p style="font-weight: 600; color: var(--navy); margin-bottom: 8px;">ü§î Deux options selon la m√©t√©o :</p>
              <p style="font-size: 0.9rem; color: var(--text-light);"><strong>Beau temps ‚Üí</strong> Royal Botanic Garden (ext√©rieur, √©cureuils, serres !)<br><strong>Pluie ‚Üí</strong> Museum of Childhood (int√©rieur, gratuit, jouets !)</p>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üåø Option A : Royal Botanic Garden</h4>
                <p>15 min en bus (n¬∞8 ou 23) ou 10 min en taxi depuis l'h√¥tel. Entr√©e gratuite ! Immenses pelouses pour courir, √©cureuils √† observer, aire de jeux, serres tropicales chauff√©es (parfait en f√©vrier). Tr√®s adapt√© aux tout-petits. Comptez 1h30‚Äì2h.</p>
                <div class="activity-tags">
                  <span class="tag tag-must">üêøÔ∏è √âcureuils & serres</span>
                  <span class="tag tag-taxi">üöå Bus ou taxi</span>
                  <span class="tag tag-free">Gratuit</span>
                  <span class="tag tag-baby">üë∂ Parfait toddler</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üß∏ Option B : Museum of Childhood</h4>
                <p>Sur le Royal Mile, 10 min √† pied. Le premier mus√©e au monde d√©di√© √† l'enfance ! Jouets anciens et modernes, poup√©es, trains miniatures, maisons de poup√©es ‚Äî Giulia va adorer. Gratuit, petit et parfait pour 1h avec un toddler.</p>
                <div class="activity-tags">
                  <span class="tag tag-rain">‚òî Indoor</span>
                  <span class="tag tag-walk">üö∂ 10 min</span>
                  <span class="tag tag-free">Gratuit</span>
                  <span class="tag tag-baby">üë∂ Jouets & poup√©es</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">14h30</div>
              <div class="activity-info">
                <h4>üõçÔ∏è Shopping & fl√¢nerie</h4>
                <p>George Street : boutiques √©l√©gantes et caf√©s. Multrees Walk : shopping haut de gamme. Princes Street : souvenirs ‚Äî whisky, tartan, shortbread. Ou simplement sieste et d√©tente.</p>
                <div class="activity-tags">
                  <span class="tag tag-walk">üö∂ Centre-ville</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">19h</div>
              <div class="activity-info">
                <h4>üéÇ D√Æner d'anniversaire de Vanessa !</h4>
                <p>Chaophraya ‚Äî rooftop tha√Ø au 4e √©tage du 33 Castle Street. Vue spectaculaire sur le ch√¢teau illumin√©, cuisine raffin√©e mais d√©contract√©e. Pensez √† r√©server √† l'avance ! <a href="tel:+441312267614" style="color:var(--gold);font-weight:600;">üìû 0131 226 7614</a></p>
                <div class="activity-tags"><span class="tag tag-must">üéÇ Anniversaire !</span><span class="tag tag-food">üç¥ Rooftop</span></div>
              </div>
            </div>
            <div class="day-map">
              <div id="dayMap5" class="day-leaflet-map"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- JOUR 6 -->
      <div class="day-card reveal">
        <div class="day-header" onclick="toggleDay(this)">
          <div class="day-number">
            <div class="day-num">25</div>
            <div class="day-weekday">Mercredi</div>
          </div>
          <div class="day-summary">
            <div class="day-title">Derni√®re Matin√©e & Retour</div>
            <div class="day-tagline">Coups de c≈ìur, derniers souvenirs, tram vers l'a√©roport</div>
          </div>
          <div class="day-toggle">‚ñº</div>
        </div>
        <div class="day-body">
          <div class="day-content">
            <div class="activity">
              <div class="activity-time">10h</div>
              <div class="activity-info">
                <h4>üíõ Vos coups de c≈ìur</h4>
                <p>Revisitez un spot favori (Grassmarket, Royal Mile), d√©couvrez Circus Lane (petite ruelle instagrammable √† Stockbridge, 10 min √† pied), ou le Palace of Holyroodhouse (espace famille avec d√©guisements).</p>
                <div class="activity-tags">
                  <span class="tag tag-walk">üö∂ √Ä pied</span>
                  <span class="tag tag-must">üì∏ Derni√®res photos</span>
                </div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">12h30</div>
              <div class="activity-info">
                <h4>üçΩÔ∏è Dernier brunch ‚Äî Urban Angel</h4>
                <p>Un dernier brunch healthy au 121 Hanover Street, juste √† c√¥t√© de l'h√¥tel. Avocado toast, eggs benedict, smoothies. Ouvert d√®s 8h30. <a href="tel:+441312256215" style="color:var(--gold);font-weight:600;">üìû 0131 225 6215</a></p>
                <div class="activity-tags"><span class="tag tag-food">üç¥ Sur votre rue</span></div>
              </div>
            </div>
            <div class="activity">
              <div class="activity-time">~16h</div>
              <div class="activity-info">
                <h4>üöã D√©part vers l'a√©roport</h4>
                <p>Tram depuis St Andrew Square (2 min de l'h√¥tel) ‚Üí A√©roport, ~35 min, ¬£6.50/adulte. Vol √† 19h05, soyez √† l'a√©roport vers 17h. Alternative : taxi ~¬£30.</p>
                <div class="activity-tags">
                  <span class="tag tag-taxi">üöã Tram recommand√©</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- GALLERY STRIP 2 -->
<div class="gallery-strip">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1535905471006-9b3b2c82ea94?w=500&q=80" alt="Edinburgh streets" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1506377585622-bedcbb027afc?w=500&q=80" alt="Calton Hill view" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1546617605-31567bc8c7d3?w=500&q=80" alt="Edinburgh Castle at night" loading="lazy">
  <img class="gallery-img" src="https://images.unsplash.com/photo-1682403683987-bae2acb07f39?w=500&q=80" alt="Edinburgh skyline" loading="lazy">
</div>

<!-- RESTAURANTS -->
<section id="restos">
  <div class="container">
    <p class="section-label">üçΩÔ∏è O√π manger</p>
    <h2 class="section-title">Nos restos rep√©r√©s</h2>
    <p class="section-desc">Restos family-friendly rep√©r√©s, avec num√©ros et liens de r√©servation. Cliquez pour appeler ou r√©server directement !</p>
    <div class="resto-grid">
      <div class="resto-card reveal">
        <h3>üçù Vittoria</h3>
        <div class="resto-location">üìç 19 George IV Bridge ‚Äî 10 min √† pied</div>
        <p>Trattoria familiale depuis 1970 ‚Äî LA vraie ambiance italienne. Pizzas, pastas, risottos en portions g√©n√©reuses. Menu kids, crayons, chaises hautes. Service chaleureux, z√©ro pr√©tention.</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441312251740" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 225 1740</a>
          <a href="https://www.vittoriagroup.co.uk/" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">R√©server</a>
          <a href="https://www.google.com/maps/search/?api=1&query=Vittoria+Restaurant,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
      <div class="resto-card reveal">
        <h3>ü•ë Urban Angel</h3>
        <div class="resto-location">üìç 121 Hanover Street ‚Äî 0 min de l'h√¥tel !</div>
        <p>Brunch/lunch healthy, produits bio et locaux. Avocado toast, bagels, smoothies. Ambiance cosy, parfait pour le petit-d√©j ou un brunch tranquille. Ouvert 8h30‚Äì15h30.</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441312256215" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 225 6215</a>
          <a href="https://www.urban-angel.co.uk/bookings" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">R√©server</a>
          <a href="https://www.google.com/maps/search/?api=1&query=Urban+Angel,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
      <div class="resto-card reveal">
        <h3>ü•ß Mums Great Comfort Food</h3>
        <div class="resto-location">üìç 4A Forrest Road ‚Äî 12 min √† pied</div>
        <p>Saucisses-pur√©e, mac & cheese, haggis, steak pies, fish & chips. Tables en Formica, ketchup sur la table, z√©ro chichi. Menu kids, portions gigantesques, sticky toffee pudding l√©gendaire. Ouvert 9h‚Äì22h.</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441312609806" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 260 9806</a>
          <a href="https://www.monsfood.com/" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">Site web</a>
          <a href="https://www.google.com/maps/search/?api=1&query=Mums+Great+Comfort+Food,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
      <div class="resto-card reveal">
        <h3>üç∫ The Scran & Scallie</h3>
        <div class="resto-location">üìç 1 Comely Bank Rd, Stockbridge ‚Äî 15 min √† pied</div>
        <p>Gastropub du chef √©toil√© Tom Kitchin. Menu enfants d√©di√© + salle de jeux pour les petits ! Cuisine √©cossaise de qualit√©, ambiance tr√®s relax. Le top pour un midi √† Stockbridge.</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441313326281" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 332 6281</a>
          <a href="https://scranandscallie.com/table-reservations/" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">R√©server</a>
          <a href="https://www.google.com/maps/search/?api=1&query=The+Scran+%26+Scallie,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
      <div class="resto-card reveal">
        <h3>ü¶ä Newtown Fox</h3>
        <div class="resto-location">üìç 2 Dundas Street ‚Äî 3 min √† pied</div>
        <p>Caf√©-resto moderne et d√©contract√©. Brunch all-day, mini pizzas et chicken strips pour les enfants, salades et sp√©cialit√©s pour les parents. Ambiance laid-back.</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441315570066" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 557 0066</a>
          <a href="https://www.newtownfox.com/" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">Site web</a>
          <a href="https://www.google.com/maps/search/?api=1&query=Newtown+Fox,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
      <div class="resto-card reveal">
        <h3>üêü Bertie's Fish & Chips</h3>
        <div class="resto-location">üìç 9 Victoria Street ‚Äî 10 min √† pied (Old Town)</div>
        <p>Fish & chips dans un cadre color√© sur la fameuse Victoria Street. Menu enfants, cuisine ouverte o√π la petite peut regarder. Le classique √©cossais par excellence !</p>
        <div style="margin-top:10px;font-size:0.85rem;display:flex;flex-wrap:wrap;gap:8px;">
          <a href="tel:+441313221000" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">üìû 0131 322 1000</a>
          <a href="https://www.bertiesfishandchips.com/" target="_blank" style="background:var(--navy);color:white;padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;">Site web</a>
          <a href="https://www.google.com/maps/search/?api=1&query=Bertie%27s+Fish+%26+Chips,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
        </div>
      </div>
    </div>

    <!-- BIRTHDAY DINNER -->
    <div style="margin-top:40px;background:linear-gradient(135deg,var(--navy),var(--royal));border-radius:20px;padding:32px;color:white;" class="reveal">
      <h3 style="font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--gold-light);margin-bottom:8px;">üéÇ D√Æner d'anniversaire de Vanessa ‚Äî Mardi 24 f√©vrier</h3>
      <p style="color:rgba(255,255,255,0.7);margin-bottom:20px;">Un resto sp√©cial pour f√™ter √ßa ! Vue sur le ch√¢teau, cuisine raffin√©e mais kid-friendly.</p>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;">
        <div style="background:rgba(255,255,255,0.1);border:2px solid var(--gold);border-radius:16px;padding:20px;">
          <div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--gold-light);margin-bottom:8px;">‚òÖ Notre choix</div>
          <h4 style="font-size:1.1rem;margin-bottom:4px;">Chaophraya ‚Äî Rooftop Thai</h4>
          <p style="font-size:0.85rem;color:rgba(255,255,255,0.7);margin-bottom:12px;">4th Floor, 33 Castle Street. Vue spectaculaire sur le ch√¢teau depuis le rooftop ! Cuisine tha√Ø raffin√©e, ambiance magique. Parfait pour un anniversaire.</p>
          <div style="display:flex;flex-wrap:wrap;gap:8px;">
            <a href="tel:+441312267614" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;font-size:0.85rem;">üìû 0131 226 7614</a>
            <a href="https://chaophraya.co.uk/edinburgh" target="_blank" style="background:white;color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;font-size:0.85rem;">R√©server</a>
            <a href="https://www.google.com/maps/search/?api=1&query=Chaophraya,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
          </div>
        </div>
        <div style="background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.15);border-radius:16px;padding:20px;">
          <div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,0.5);margin-bottom:8px;">Alternative</div>
          <h4 style="font-size:1.1rem;margin-bottom:4px;">Caf√© St Honor√© ‚Äî Bistrot fran√ßais</h4>
          <p style="font-size:0.85rem;color:rgba(255,255,255,0.7);margin-bottom:12px;">34 NW Thistle Street Lane. Bistrot parisien intime, menu qui change tous les jours avec les meilleurs produits √©cossais. Tr√®s classe sans √™tre guind√©.</p>
          <div style="display:flex;flex-wrap:wrap;gap:8px;">
            <a href="tel:+441312262211" style="background:var(--gold);color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;font-size:0.85rem;">üìû 0131 226 2211</a>
            <a href="https://www.cafesthonore.com/book-online" target="_blank" style="background:white;color:var(--navy);padding:5px 12px;border-radius:20px;text-decoration:none;font-weight:600;font-size:0.85rem;">R√©server</a>
            <a href="https://www.google.com/maps/search/?api=1&query=Caf%C3%A9+St+Honor%C3%A9,+Edinburgh" target="_blank" class="yaller-btn" style="padding:5px 12px;font-size:0.85rem;">üß≠ Y aller</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- TIPS -->
<section id="tips">
  <div class="container">
    <p class="section-label">üí° Bon √† savoir</p>
    <h2 class="section-title">Tips & Astuces</h2>
    <p class="section-desc">Les petits trucs qui font la diff√©rence pour un s√©jour r√©ussi avec un toddler en √âcosse.</p>
    <div class="tips-grid">
      <div class="tip-card reveal">
        <div class="tip-icon">üë∂</div>
        <h3>Rythme b√©b√©</h3>
        <p>On a pr√©vu des demi-journ√©es avec pauses sieste int√©gr√©es. N'h√©sitez pas √† zapper une activit√©. Moins c'est plus avec un b√©b√© de 19 mois.</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">‚òï</div>
        <h3>La ville du caf√©</h3>
        <p>√âdimbourg est LA ville du caf√© en Europe. Arr√™tez-vous partout, c'est toujours bon et toujours cosy. Flat white obligatoire.</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üå¶Ô∏è</div>
        <h3>M√©t√©o capricieuse</h3>
        <p>On dit qu'√âdimbourg peut offrir les 4 saisons en une journ√©e. Imperm√©able toujours √† port√©e de main, m√™me si le matin est ensoleill√© !</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø</div>
        <h3>Haggis √† go√ªter</h3>
        <p>C'est bien meilleur que ce qu'on imagine ! Essayez les ¬´ haggis bon bons ¬ª (beignets de haggis) ‚Äî excellent snack dans les pubs.</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üèòÔ∏è</div>
        <h3>Explorez les Closes</h3>
        <p>Les petites ruelles qui partent du Royal Mile s'appellent des ¬´ closes ¬ª. Chacune a son charme et son histoire ‚Äî poussez les portes !</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üç∫</div>
        <h3>Pubs family-friendly</h3>
        <p>Les pubs √©cossais sont souvent family-friendly en journ√©e. N'h√©sitez pas √† entrer pour un lunch ou une pinte. Ambiance garantie.</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üí∑</div>
        <h3>Paiement</h3>
        <p>Le sans-contact fonctionne partout (y compris les taxis). Pas besoin de retirer du cash. Apple Pay / Google Pay accept√©s quasi partout.</p>
      </div>
      <div class="tip-card reveal">
        <div class="tip-icon">üïê</div>
        <h3>D√©calage horaire</h3>
        <p>UK = GMT, soit 1h de moins que la Suisse. Quand il est midi √† Gen√®ve, il est 11h √† √âdimbourg. √áa joue surtout pour le rythme de b√©b√©.</p>
      </div>
    </div>
  </div>
</section>

<!-- VALISE -->
<section id="valise">
  <div class="container">
    <p class="section-label">üß≥ Checklist</p>
    <h2 class="section-title">Ce qu'il faut dans la valise</h2>
    <p class="section-desc">F√©vrier √† √âdimbourg = froid, vent et pluie possible. Voil√† l'essentiel √† ne pas oublier.</p>
    <div class="packing-grid">
      <div class="packing-category reveal">
        <h3>üß• V√™tements</h3>
        <ul>
          <li>Manteau chaud + imperm√©able</li>
          <li>Sous-couches thermiques</li>
          <li>Polaire ou pull chaud</li>
          <li>√âcharpe, bonnet, gants</li>
          <li>Chaussures imperm√©ables</li>
          <li>Chaussettes chaudes</li>
        </ul>
      </div>
      <div class="packing-category reveal">
        <h3>üë∂ Pour b√©b√©</h3>
        <ul>
          <li>Porte-b√©b√© (indispensable !)</li>
          <li>Poussette compacte</li>
          <li>Habillage pluie poussette</li>
          <li>Combinaison chaude</li>
          <li>Snacks & eau</li>
          <li>Jouets de voyage</li>
        </ul>
      </div>
      <div class="packing-category reveal">
        <h3>üì± Tech & Pratique</h3>
        <ul>
          <li>Adaptateur prise UK (type G)</li>
          <li>Chargeurs / batterie externe</li>
          <li>App Free Now install√©e</li>
          <li>App Google Maps offline</li>
          <li>Parapluie compact</li>
          <li>Sac √† dos journ√©e</li>
        </ul>
      </div>
      <div class="packing-category reveal">
        <h3>üìÑ Documents</h3>
        <ul>
          <li>Passeports (CH ‚Üí UK post-Brexit)</li>
          <li>Cartes d'embarquement</li>
          <li>Confirmation h√¥tel</li>
          <li>Assurance voyage</li>
          <li>Carte europ√©enne d'assurance maladie</li>
          <li>Carnet de sant√© b√©b√©</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- QUE FAIRE FAB + PANEL -->
<button class="qf-fab" onclick="openQF()">
  üß≠ <span>Que faire ?</span>
</button>

<div class="qf-overlay" id="qfOverlay" onclick="closeQF()"></div>

<div class="qf-panel" id="qfPanel">
  <div class="qf-handle"></div>
  <div class="qf-panel-header">
    <h3>üß≠ Que faire maintenant ?</h3>
    <button class="qf-close" onclick="closeQF()">‚úï</button>
  </div>

  <div class="qf-main-choices">
    <button class="qf-choice" onclick="selectQFMode('manger',this)">
      <span class="qf-choice-icon">üç¥</span>Manger
    </button>
    <button class="qf-choice" onclick="selectQFMode('activite',this)">
      <span class="qf-choice-icon">üó∫Ô∏è</span>Activit√©
    </button>
    <button class="qf-choice" onclick="selectQFMode('balade',this)">
      <span class="qf-choice-icon">üö∂</span>Balade
    </button>
  </div>

  <div id="qfSpecific"></div>

  <div class="qf-context" id="qfContext">
    <div class="qf-field">
      <label>üìç O√π √™tes-vous ?</label>
      <div class="qf-options">
        <button class="qf-opt qf-geolocate" onclick="geolocateMe(this)">üìç Me localiser</button>
        <button class="qf-opt active" data-qfgroup="location" data-value="hotel" onclick="selectQFCtx('location','hotel',this)">üè® H√¥tel</button>
        <button class="qf-opt" data-qfgroup="location" data-value="oldtown" onclick="selectQFCtx('location','oldtown',this)">üè∞ Old Town</button>
        <button class="qf-opt" data-qfgroup="location" data-value="grassmarket" onclick="selectQFCtx('location','grassmarket',this)">üç∫ Grassmarket</button>
        <button class="qf-opt" data-qfgroup="location" data-value="stockbridge" onclick="selectQFCtx('location','stockbridge',this)">üåø Stockbridge</button>
        <button class="qf-opt" data-qfgroup="location" data-value="leith" onclick="selectQFCtx('location','leith',this)">‚öì Leith</button>
      </div>
    </div>
    <div class="qf-context-inline">
      <div class="qf-field">
        <label>‚ö° √ânergie</label>
        <div class="qf-options">
          <button class="qf-opt" data-qfgroup="energie" data-value="tired" onclick="selectQFCtx('energie','tired',this)">üò¥</button>
          <button class="qf-opt active" data-qfgroup="energie" data-value="normal" onclick="selectQFCtx('energie','normal',this)">üòä</button>
          <button class="qf-opt" data-qfgroup="energie" data-value="energetic" onclick="selectQFCtx('energie','energetic',this)">üí™</button>
        </div>
      </div>
      <div class="qf-field">
        <label>üå§Ô∏è M√©t√©o</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfgroup="meteo" data-value="sun" onclick="selectQFCtx('meteo','sun',this)">‚òÄÔ∏è</button>
          <button class="qf-opt" data-qfgroup="meteo" data-value="rain" onclick="selectQFCtx('meteo','rain',this)">‚òî</button>
        </div>
      </div>
    </div>
  </div>

  <div class="qf-cta-wrap" id="qfCTA">
    <button class="qf-cta-btn" id="qfCTABtn" onclick="runQFSearch()">‚ú® Trouver !</button>
  </div>

  <div id="qfResults"></div>
</div>

<!-- EXPLORER FAB -->
<button class="explorer-fab" onclick="openExplorer()">üó∫Ô∏è Explorer</button>

<!-- EXPLORER OVERLAY -->
<div id="explorerOverlay" class="explorer-overlay">
  <div class="explorer-header">
    <h3>üó∫Ô∏è Explorer √âdimbourg</h3>
    <button class="explorer-close" onclick="closeExplorer()">‚úï</button>
  </div>
  <div class="explorer-map-container">
    <div id="explorerMap"></div>
    <button class="explorer-gps-btn" id="explorerGpsBtn" onclick="toggleExplorerGps()">üìç</button>
  </div>
  <div class="explorer-filters" id="explorerFilters">
    <button class="explorer-filter-pill active" data-cat="all" onclick="filterExplorer('all',this)">Tout</button>
    <button class="explorer-filter-pill" data-cat="culture" onclick="filterExplorer('culture',this)">üèõÔ∏è Culture</button>
    <button class="explorer-filter-pill" data-cat="nature" onclick="filterExplorer('nature',this)">üåø Nature</button>
    <button class="explorer-filter-pill" data-cat="jeux" onclick="filterExplorer('jeux',this)">üé™ Jeux</button>
    <button class="explorer-filter-pill" data-cat="manger" onclick="filterExplorer('manger',this)">üç¥ Manger</button>
    <button class="explorer-filter-pill" data-cat="shopping" onclick="filterExplorer('shopping',this)">üõçÔ∏è Shopping</button>
    <button class="explorer-filter-pill" data-cat="balade" onclick="filterExplorer('balade',this)">üö∂ Balades</button>
  </div>
  <div class="explorer-controls">
    <span id="explorerCount"></span>
    <div class="explorer-sort">
      <button class="active" onclick="sortExplorer('distance',this)">Plus proche</button>
      <button onclick="sortExplorer('free',this)">Gratuit d'abord</button>
      <button onclick="sortExplorer('baby',this)">Top b√©b√©</button>
    </div>
  </div>
  <div class="explorer-list" id="explorerList"></div>
</div>

<!-- AI ADAPT MODAL -->
<div id="adaptModal" class="adapt-modal-overlay" onclick="closeAdaptModal(event)">
  <div class="adapt-modal" onclick="event.stopPropagation()">
    <div class="adapt-modal-header">
      <h3>‚ú® Adapter mon planning</h3>
      <p id="adaptModalDayTitle" class="adapt-modal-subtitle"></p>
    </div>
    <div class="adapt-field">
      <label>Heure de sortie de l'h√¥tel</label>
      <input type="time" id="wakeUpTime" value="10:00">
    </div>
    <div class="adapt-field">
      <label>Notre √©nergie du jour</label>
      <div class="adapt-options">
        <button class="adapt-option" data-group="energy" data-value="tired" onclick="selectAdaptOption('energy','tired',this)">üò¥ Fatigu√©s</button>
        <button class="adapt-option active" data-group="energy" data-value="normal" onclick="selectAdaptOption('energy','normal',this)">üòä Normal</button>
        <button class="adapt-option" data-group="energy" data-value="energetic" onclick="selectAdaptOption('energy','energetic',this)">üí™ En forme</button>
      </div>
    </div>
    <div class="adapt-field">
      <label>Sieste de Giulia</label>
      <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
        <input type="time" id="napTime" value="14:00">
        <label style="display:flex; align-items:center; gap:6px; cursor:pointer; font-size:0.85rem; color:var(--text-light); user-select:none;">
          <input type="checkbox" id="noNapToggle" onchange="toggleNoNap(this.checked)" style="accent-color:var(--gold); width:18px; height:18px; cursor:pointer;">
          Pas de sieste aujourd'hui
        </label>
      </div>
    </div>
    <div class="adapt-field">
      <label>M√©t√©o pr√©vue</label>
      <div class="adapt-options">
        <button class="adapt-option active" data-group="weather" data-value="sun" onclick="selectAdaptOption('weather','sun',this)">‚òÄÔ∏è Soleil</button>
        <button class="adapt-option" data-group="weather" data-value="rain" onclick="selectAdaptOption('weather','rain',this)">‚òî Pluie</button>
      </div>
    </div>
    <div class="adapt-field">
      <label>Quelque chose √† pr√©ciser ? (optionnel)</label>
      <textarea id="adaptFreeText" placeholder="Ex : On a envie de rester dans le centre, Giulia est grognon, on veut un truc calme, on a d√©j√† fait le ch√¢teau hier..." style="width:100%;min-height:60px;border:1.5px solid var(--stone);border-radius:10px;padding:10px;font-size:0.85rem;font-family:'Inter',sans-serif;resize:vertical;box-sizing:border-box;"></textarea>
    </div>
    <div class="adapt-modal-footer">
      <button class="adapt-cancel" onclick="closeAdaptModal()">Annuler</button>
      <button class="adapt-generate" id="adaptGenerateBtn" onclick="generateAdaptedPlan()">‚ú® G√©n√©rer le planning</button>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-flag">üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø</div>
  <p>Pr√©par√© avec <span class="heart">‚ù§Ô∏è</span> pour notre aventure en famille</p>
  <p style="margin-top: 8px; opacity: 0.5;">√âdimbourg ‚Äî F√©vrier 2026</p>
</footer>

<script>
// Toggle day cards
function toggleDay(header) {
  const card = header.closest('.day-card');
  card.classList.toggle('open');
  const dayMapEl = card.querySelector('[id^="dayMap"]');
  if (dayMapEl && card.classList.contains('open')) {
    const dayNum = dayMapEl.id.replace('dayMap', '');
    setTimeout(() => initDayMap(parseInt(dayNum)), 350);
  }
}

// Scroll reveal
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
    }
  });
}, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

// Nav scroll effect
const nav = document.getElementById('mainNav');
window.addEventListener('scroll', () => {
  nav.classList.toggle('scrolled', window.scrollY > 100);
});

// Active nav link
const sections = document.querySelectorAll('section[id]');
window.addEventListener('scroll', () => {
  let current = '';
  sections.forEach(section => {
    const top = section.offsetTop - 120;
    if (window.scrollY >= top) current = section.getAttribute('id');
  });
  document.querySelectorAll('.nav a').forEach(a => {
    a.classList.toggle('active', a.getAttribute('href') === '#' + current);
  });
});

// Auto-open first day card
document.querySelector('.day-card').classList.add('open');

// ===== AI ADAPT FEATURE =====
let currentAdaptCard = null;
let selectedAdaptEnergy = 'normal';
let selectedAdaptWeather = 'sun';

// Inject adapt buttons and result containers into each day card
document.querySelectorAll('.day-card').forEach((card) => {
  const dayTitle = card.querySelector('.day-title')?.textContent?.trim() || '';
  const toggle = card.querySelector('.day-toggle');
  const btn = document.createElement('button');
  btn.className = 'adapt-btn';
  btn.innerHTML = '‚ú® Adapter';
  btn.title = 'Adapter ce planning avec l\'IA selon votre forme du jour';
  btn.onclick = (e) => { e.stopPropagation(); openAdaptModal(card, dayTitle); };
  toggle.before(btn);

  const dayContent = card.querySelector('.day-content');
  if (dayContent) {
    const resultDiv = document.createElement('div');
    resultDiv.className = 'ai-result';
    dayContent.appendChild(resultDiv);
  }
});

// Inject Google Maps buttons into each activity ‚Äî both main button and inline buttons per option
const MAPS_PLACES = {
  'Edinburgh Castle': 'Edinburgh Castle, Edinburgh',
  "Bertie's Fish & Chips": "Bertie's Fish & Chips, Victoria Street, Edinburgh",
  'Bertie\'s': "Bertie's Fish & Chips, Victoria Street, Edinburgh",
  'Victoria Street': 'Victoria Street, Edinburgh',
  'Royal Mile': 'Royal Mile, Edinburgh',
  'Vittoria': 'Vittoria Restaurant, George IV Bridge, Edinburgh',
  'Dean Village': 'Dean Village, Edinburgh',
  'Water of Leith': 'Water of Leith Walkway, Edinburgh',
  'Scran & Scallie': 'The Scran & Scallie, Stockbridge, Edinburgh',
  'The Vennel': 'The Vennel, Edinburgh',
  'Greyfriars Bobby': 'Greyfriars Bobby Statue, Edinburgh',
  'Greyfriars': 'Greyfriars Bobby Statue, Edinburgh',
  'Princes Street': 'Princes Street, Edinburgh',
  'National Museum': 'National Museum of Scotland, Edinburgh',
  'Museum of Childhood': 'Museum of Childhood, Royal Mile, Edinburgh',
  'Princes Street Gardens': 'Princes Street Gardens, Edinburgh',
  'Calton Hill': 'Calton Hill, Edinburgh',
  'Mums': 'Mums Great Comfort Food, Forrest Road, Edinburgh',
  'Newtown Fox': 'Newtown Fox, Dundas Street, Edinburgh',
  'Royal Botanic Garden': 'Royal Botanic Garden Edinburgh',
  'Chaophraya': 'Chaophraya, Castle Street, Edinburgh',
  'George Street': 'George Street, Edinburgh',
  'Urban Angel': 'Urban Angel, Hanover Street, Edinburgh',
  'Grassmarket': 'Grassmarket, Edinburgh',
  'Stockbridge': 'Stockbridge, Edinburgh',
  'Camera Obscura': 'Camera Obscura, Castlehill, Edinburgh',
  'Holyrood Park': 'Holyrood Park, Edinburgh',
  "Mary's Milk Bar": "Mary's Milk Bar, Grassmarket, Edinburgh",
  'Circus Lane': 'Circus Lane, Stockbridge, Edinburgh',
  'Civerinos': 'Civerinos, Hunter Square, Edinburgh',
  'Piemaker': 'The Piemaker, South Bridge, Edinburgh',
  'The Pantry': 'The Pantry, Stockbridge, Edinburgh',
  "Loudon's": "Loudon's Cafe, Fountainbridge, Edinburgh",
  'Bread Meats Bread': 'Bread Meats Bread, Lothian Road, Edinburgh',
  "Marks & Spencer": "Marks & Spencer, Princes Street, Edinburgh",
  'Tesco Express': 'Tesco Express, Nicolson Street, Edinburgh',
  'Scott Monument': 'Scott Monument, Edinburgh',
  'Portobello Beach': 'Portobello Beach, Edinburgh'
};

function mapsUrl(placeName) {
  const query = MAPS_PLACES[placeName] || (placeName + ', Edinburgh, Scotland');
  return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
}

// Inject inline üìç buttons next to each <strong> place name in activity descriptions
document.querySelectorAll('.day-card .activity .activity-info p').forEach(p => {
  p.querySelectorAll('strong').forEach(strong => {
    const text = strong.textContent.trim();
    // Skip non-place strong tags
    if (/option|beau temps|pluie|si en forme|si fatigu|alternative|deliveroo|uber/i.test(text)) return;
    // Find matching place
    let matched = null;
    for (const name of Object.keys(MAPS_PLACES)) {
      if (text.toLowerCase().includes(name.toLowerCase())) { matched = name; break; }
    }
    if (!matched) return;
    // Don't add duplicate
    if (strong.nextElementSibling && strong.nextElementSibling.classList && strong.nextElementSibling.classList.contains('inline-maps-btn')) return;
    const link = document.createElement('a');
    link.href = mapsUrl(matched);
    link.target = '_blank';
    link.rel = 'noopener';
    link.className = 'inline-maps-btn';
    link.textContent = 'üìç';
    strong.after(link);
  });
});

// Also add a main Maps button on activities with a single clear location (not multi-option)
document.querySelectorAll('.day-card .activity').forEach(activity => {
  const titleEl = activity.querySelector('.activity-info h4');
  if (!titleEl) return;
  const title = titleEl.textContent.trim();
  if (/sieste|repos|d√©collage|arriv√©e|installation|d√©part|a√©roport|petit-d√©j|brunch|d√©jeuner|soir√©e.*appart/i.test(title)) return;
  const descEl = activity.querySelector('.activity-info p');
  const searchText = title.toLowerCase() + ' ' + (descEl ? descEl.textContent.toLowerCase() : '');
  let matchedName = null;
  for (const name of Object.keys(MAPS_PLACES)) {
    if (searchText.includes(name.toLowerCase())) { matchedName = name; break; }
  }
  if (!matchedName) return;
  // Skip if this activity already has multiple inline maps buttons (multi-option)
  const inlineCount = activity.querySelectorAll('.inline-maps-btn').length;
  if (inlineCount > 1) return;
  const link = document.createElement('a');
  link.href = mapsUrl(matchedName);
  link.target = '_blank';
  link.rel = 'noopener';
  link.className = 'activity-maps-btn';
  link.innerHTML = 'üìç Google Maps';
  const info = activity.querySelector('.activity-info');
  if (info) info.appendChild(link);
});

function openAdaptModal(card, dayTitle) {
  currentAdaptCard = card;
  document.getElementById('adaptModalDayTitle').textContent = dayTitle;
  document.getElementById('adaptModal').classList.add('open');
  document.body.style.overflow = 'hidden';
  selectedAdaptEnergy = 'normal';
  selectedAdaptWeather = 'sun';
  document.querySelectorAll('[data-group="energy"]').forEach(b => b.classList.toggle('active', b.dataset.value === 'normal'));
  document.querySelectorAll('[data-group="weather"]').forEach(b => b.classList.toggle('active', b.dataset.value === 'sun'));
  const noNapToggle = document.getElementById('noNapToggle');
  noNapToggle.checked = false;
  toggleNoNap(false);
  document.getElementById('adaptFreeText').value = '';
  const genBtn = document.getElementById('adaptGenerateBtn');
  genBtn.disabled = false;
  genBtn.textContent = '‚ú® G√©n√©rer le planning';
}

function closeAdaptModal(event) {
  if (event && event.target !== event.currentTarget) return;
  document.getElementById('adaptModal').classList.remove('open');
  document.body.style.overflow = '';
}

function selectAdaptOption(group, value, btn) {
  if (group === 'energy') selectedAdaptEnergy = value;
  if (group === 'weather') selectedAdaptWeather = value;
  document.querySelectorAll(`[data-group="${group}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function toggleNoNap(checked) {
  const napInput = document.getElementById('napTime');
  napInput.disabled = checked;
  napInput.style.opacity = checked ? '0.4' : '1';
}

function extractDayActivities(dayCard) {
  const activities = [];
  dayCard.querySelectorAll('.activity').forEach(activity => {
    const time = activity.querySelector('.activity-time')?.textContent?.trim() || '';
    const title = activity.querySelector('.activity-info h4')?.textContent?.trim() || '';
    const descEl = activity.querySelector('.activity-info p');
    const desc = descEl ? descEl.innerText.replace(/üìû.*/g, '').trim() : '';
    if (title) activities.push({ time, title, description: desc });
  });
  return activities;
}

async function generateAdaptedPlan() {
  if (!currentAdaptCard) return;

  const wakeUpTime = document.getElementById('wakeUpTime').value.replace(':', 'h'); // departure time
  const noNap = document.getElementById('noNapToggle').checked;
  const napTime = noNap ? 'pas de sieste' : document.getElementById('napTime').value.replace(':', 'h');
  const freeText = document.getElementById('adaptFreeText').value.trim();
  const dayTitle = document.getElementById('adaptModalDayTitle').textContent;
  const dayNum = currentAdaptCard.querySelector('.day-num')?.textContent?.trim() || '';
  const dayWeekday = currentAdaptCard.querySelector('.day-weekday')?.textContent?.trim() || '';
  const dayDate = `${dayNum} F√©vrier (${dayWeekday})`;
  const activities = extractDayActivities(currentAdaptCard);

  const genBtn = document.getElementById('adaptGenerateBtn');
  genBtn.disabled = true;
  genBtn.textContent = '‚è≥ G√©n√©ration...';

  const resultDiv = currentAdaptCard.querySelector('.ai-result');
  if (resultDiv) {
    resultDiv.innerHTML = `<div class="adapt-loading"><div class="adapt-loading-spinner"></div><p style="font-size:0.95rem">L'IA adapte votre planning...</p></div>`;
    resultDiv.classList.add('visible');
    currentAdaptCard.classList.add('open');
  }

  document.getElementById('adaptModal').classList.remove('open');
  document.body.style.overflow = '';

  setTimeout(() => currentAdaptCard.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);

  const energyLabels = { tired: 'üò¥ Fatigu√©s', normal: 'üòä Normal', energetic: 'üí™ En forme' };
  const weatherLabels = { sun: '‚òÄÔ∏è Soleil', rain: '‚òî Pluie' };

  try {
    const response = await fetch('/.netlify/functions/adapt-plan', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        dayTitle, dayDate, activities,
        wakeUpTime, energyLevel: selectedAdaptEnergy,
        napTime, weather: selectedAdaptWeather, freeText
      })
    });

    if (!response.ok) {
      let errMsg = `Erreur serveur : ${response.status}`;
      try { const errData = await response.json(); errMsg = errData.error || errMsg; } catch {}
      throw new Error(errMsg);
    }
    const data = await response.json();
    if (data.error) throw new Error(data.error);

    let adapted;
    try {
      const cleaned = data.adapted.trim().replace(/^```json\n?/, '').replace(/\n?```$/, '').trim();
      adapted = JSON.parse(cleaned);
    } catch {
      if (resultDiv) renderRawResult(resultDiv, data.adapted, wakeUpTime, energyLabels, weatherLabels);
      return;
    }

    if (resultDiv && Array.isArray(adapted)) {
      const meta = `${energyLabels[selectedAdaptEnergy]} ¬∑ Sortie ${wakeUpTime} ¬∑ ${weatherLabels[selectedAdaptWeather]}`;
      const activitiesHTML = adapted.map(act => `
        <div class="ai-activity">
          <div class="ai-activity-time">${act.heure || ''}</div>
          <div>
            <div class="ai-activity-title">${act.titre || ''}</div>
            <div class="ai-activity-desc">${act.description || ''}</div>
            ${act.conseil ? `<div class="ai-activity-conseil">üí° ${act.conseil}</div>` : ''}
          </div>
        </div>`).join('');
      resultDiv.innerHTML = `
        <div class="ai-result-header">
          <div>
            <h4>‚ú® Planning adapt√© par l'IA</h4>
            <div class="ai-result-meta">${meta}</div>
          </div>
          <button class="ai-result-close" onclick="this.closest('.ai-result').classList.remove('visible')">Fermer ‚úï</button>
        </div>
        <div class="ai-result-body">${activitiesHTML}</div>`;
    }
  } catch (err) {
    if (resultDiv) {
      resultDiv.innerHTML = `
        <div class="ai-result-header" style="background:#c53030">
          <div><h4>Erreur de g√©n√©ration</h4></div>
          <button class="ai-result-close" onclick="this.closest('.ai-result').classList.remove('visible')">Fermer ‚úï</button>
        </div>
        <div class="ai-result-body">
          <p style="color:#c53030;font-weight:600">${err.message}</p>
          <p style="color:var(--text-light);font-size:0.85rem;margin-top:8px">V√©rifiez que la variable GEMINI_API_KEY est bien configur√©e dans Netlify.</p>
        </div>`;
    }
  }
}

function renderRawResult(resultDiv, text, wakeUpTime, energyLabels, weatherLabels) {
  const meta = `${energyLabels[selectedAdaptEnergy]} ¬∑ Sortie ${wakeUpTime} ¬∑ ${weatherLabels[selectedAdaptWeather]}`;
  resultDiv.innerHTML = `
    <div class="ai-result-header">
      <div><h4>‚ú® Planning adapt√©</h4><div class="ai-result-meta">${meta}</div></div>
      <button class="ai-result-close" onclick="this.closest('.ai-result').classList.remove('visible')">Fermer ‚úï</button>
    </div>
    <div class="ai-result-body"><p style="white-space:pre-line;font-size:0.9rem;line-height:1.7">${text}</p></div>`;
}

// ===== QUE FAIRE FEATURE =====
const qfState = {
  mode: null,
  preferences: {},
  context: { location: 'hotel', energie: 'normal', meteo: 'sun', heure: '' }
};

const QF_DEFAULTS = {
  manger: { repas: 'snack', budget: 'petit', ambiance: 'peu_importe' },
  activite: { type: 'peu_importe', duree: 'moyen', budget: 'ok' },
  balade: { duree: 'moyen', poussette: 'oui', envie: 'peu_importe' }
};

function openQF() {
  document.getElementById('qfPanel').classList.add('open');
  document.getElementById('qfOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
  const now = new Date();
  qfState.context.heure = `${now.getHours()}h${String(now.getMinutes()).padStart(2,'0')}`;
}

function closeQF() {
  document.getElementById('qfPanel').classList.remove('open');
  document.getElementById('qfOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function selectQFMode(mode, btn) {
  qfState.mode = mode;
  qfState.preferences = { ...QF_DEFAULTS[mode] };
  document.querySelectorAll('.qf-choice').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('qfContext').classList.add('visible');
  document.getElementById('qfCTA').classList.add('visible');
  document.getElementById('qfResults').innerHTML = '';
  renderQFSpecific(mode);
  // Reset CTA
  const ctaBtn = document.getElementById('qfCTABtn');
  ctaBtn.disabled = false;
  ctaBtn.textContent = '‚ú® Trouver !';
}

function renderQFSpecific(mode) {
  const container = document.getElementById('qfSpecific');
  const templates = {
    manger: `<div class="qf-specific-inner">
      <div class="qf-field">
        <label>Type de repas</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="repas" data-value="snack" onclick="setQFPref('repas','snack',this)">‚òï Snack / caf√©</button>
          <button class="qf-opt" data-qfpref="repas" data-value="repas" onclick="setQFPref('repas','repas',this)">üçΩÔ∏è Vrai repas</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Budget</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="budget" data-value="petit" onclick="setQFPref('budget','petit',this)">¬£ Petit</button>
          <button class="qf-opt" data-qfpref="budget" data-value="moyen" onclick="setQFPref('budget','moyen',this)">¬£¬£ Moyen</button>
          <button class="qf-opt" data-qfpref="budget" data-value="libre" onclick="setQFPref('budget','libre',this)">¬£¬£¬£ Libre</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Ambiance</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="ambiance" data-value="peu_importe" onclick="setQFPref('ambiance','peu_importe',this)">Peu importe</button>
          <button class="qf-opt" data-qfpref="ambiance" data-value="calme" onclick="setQFPref('ambiance','calme',this)">üïØÔ∏è Calme</button>
          <button class="qf-opt" data-qfpref="ambiance" data-value="anime" onclick="setQFPref('ambiance','anime',this)">üéâ Anim√©</button>
        </div>
      </div>
    </div>`,
    activite: `<div class="qf-specific-inner">
      <div class="qf-field">
        <label>Int√©rieur ou ext√©rieur ?</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="type" data-value="peu_importe" onclick="setQFPref('type','peu_importe',this)">Peu importe</button>
          <button class="qf-opt" data-qfpref="type" data-value="indoor" onclick="setQFPref('type','indoor',this)">üèõÔ∏è Int√©rieur</button>
          <button class="qf-opt" data-qfpref="type" data-value="outdoor" onclick="setQFPref('type','outdoor',this)">üå≥ Ext√©rieur</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Temps disponible</label>
        <div class="qf-options">
          <button class="qf-opt" data-qfpref="duree" data-value="court" onclick="setQFPref('duree','court',this)">‚ö° 30‚Äì45 min</button>
          <button class="qf-opt active" data-qfpref="duree" data-value="moyen" onclick="setQFPref('duree','moyen',this)">üïê 1‚Äì2h</button>
          <button class="qf-opt" data-qfpref="duree" data-value="long" onclick="setQFPref('duree','long',this)">‚òÄÔ∏è Demi-journ√©e</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Budget</label>
        <div class="qf-options">
          <button class="qf-opt" data-qfpref="budget" data-value="gratuit" onclick="setQFPref('budget','gratuit',this)">üíö Gratuit</button>
          <button class="qf-opt active" data-qfpref="budget" data-value="ok" onclick="setQFPref('budget','ok',this)">üí≥ Payant OK</button>
        </div>
      </div>
    </div>`,
    balade: `<div class="qf-specific-inner">
      <div class="qf-field">
        <label>Dur√©e</label>
        <div class="qf-options">
          <button class="qf-opt" data-qfpref="duree" data-value="court" onclick="setQFPref('duree','court',this)">‚ö° 20‚Äì30 min</button>
          <button class="qf-opt active" data-qfpref="duree" data-value="moyen" onclick="setQFPref('duree','moyen',this)">üö∂ 45min‚Äì1h</button>
          <button class="qf-opt" data-qfpref="duree" data-value="long" onclick="setQFPref('duree','long',this)">ü•æ 1h30+</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Avec poussette ?</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="poussette" data-value="oui" onclick="setQFPref('poussette','oui',this)">üçº Oui, poussette</button>
          <button class="qf-opt" data-qfpref="poussette" data-value="non" onclick="setQFPref('poussette','non',this)">üéí Porte-b√©b√© OK</button>
        </div>
      </div>
      <div class="qf-field">
        <label>Envie de voir ?</label>
        <div class="qf-options">
          <button class="qf-opt active" data-qfpref="envie" data-value="peu_importe" onclick="setQFPref('envie','peu_importe',this)">üåü Peu importe</button>
          <button class="qf-opt" data-qfpref="envie" data-value="vue" onclick="setQFPref('envie','vue',this)">üî≠ Vue</button>
          <button class="qf-opt" data-qfpref="envie" data-value="pittoresque" onclick="setQFPref('envie','pittoresque',this)">üì∏ Pittoresque</button>
          <button class="qf-opt" data-qfpref="envie" data-value="nature" onclick="setQFPref('envie','nature',this)">üåø Nature</button>
        </div>
      </div>
    </div>`
  };
  container.innerHTML = templates[mode] || '';
}

function setQFPref(key, value, btn) {
  qfState.preferences[key] = value;
  document.querySelectorAll(`#qfSpecific [data-qfpref="${key}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function selectQFCtx(group, value, btn) {
  qfState.context[group] = value;
  document.querySelectorAll(`#qfContext [data-qfgroup="${group}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

async function runQFSearch() {
  if (!qfState.mode) return;
  const btn = document.getElementById('qfCTABtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ Recherche...';
  const resultsDiv = document.getElementById('qfResults');
  resultsDiv.innerHTML = `<div class="qf-loading"><div class="qf-spinner"></div><p style="font-size:0.9rem">L'IA cherche la meilleure option pour vous...</p></div>`;

  const now = new Date();
  qfState.context.heure = `${now.getHours()}h${String(now.getMinutes()).padStart(2,'0')}`;

  try {
    const res = await fetch('/.netlify/functions/que-faire', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(qfState)
    });
    if (!res.ok) {
      let errMsg = `Erreur ${res.status}`;
      try { const errData = await res.json(); errMsg = errData.error || errMsg; } catch {}
      throw new Error(errMsg);
    }
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    let suggestions;
    try {
      const cleaned = data.suggestions.trim().replace(/^```json\n?/, '').replace(/\n?```$/, '').trim();
      suggestions = JSON.parse(cleaned);
    } catch {
      resultsDiv.innerHTML = `<div class="qf-results-header">‚ú® Suggestions</div><div style="padding:12px 0;font-size:0.9rem;line-height:1.6;white-space:pre-line">${data.suggestions}</div>`;
      return;
    }

    if (Array.isArray(suggestions) && suggestions.length) {
      resultsDiv.innerHTML = `
        <div class="qf-results-header">‚ú® Voici nos suggestions</div>
        ${suggestions.map((s, i) => `
          <div class="qf-suggestion" style="animation-delay:${i * 0.1}s" onclick="panToSuggestion(${i})">
            <div class="qf-sug-top">
              <span class="qf-sug-emoji">${s.emoji || 'üìç'}</span>
              <div>
                <div class="qf-sug-name">${s.nom || ''}</div>
                <div class="qf-sug-badge">${s.badge || ''}</div>
              </div>
            </div>
            <div class="qf-sug-pourquoi">${s.pourquoi || ''}</div>
            ${s.detail ? `<div class="qf-sug-detail">${s.detail}</div>` : ''}
            <div class="qf-sug-footer">
              ${s.adresse ? `<span>üìç ${s.adresse}</span>` : ''}
              ${s.contact ? `<span>üìû ${s.contact}</span>` : ''}
            </div>
            <div class="qf-sug-actions">
              ${getNavButton(s.nom, s.adresse)}
              <button class="voir-autres-btn" onclick="showAlternatives('${qfState.mode}','${(s.nom||'').replace(/'/g,"\\'")}',event)">üëÄ Voir d'autres</button>
            </div>
          </div>`).join('')}
        <div id="qfMap" class="qf-map-container"></div>`;
      setTimeout(() => initQFMap(suggestions), 100);
    }
  } catch (err) {
    resultsDiv.innerHTML = `<div class="qf-error"><strong>Erreur :</strong> ${err.message}<br><small style="color:var(--text-light);margin-top:6px;display:block">V√©rifiez que GEMINI_API_KEY est configur√©e dans Netlify.</small></div>`;
  } finally {
    btn.disabled = false;
    btn.textContent = '‚ú® Trouver !';
  }
}

// ===== GEOLOCATION =====
const GEO_ZONES = [
  { id: 'hotel', label: 'H√¥tel', lat: 55.9533, lng: -3.1955 },
  { id: 'oldtown', label: 'Old Town', lat: 55.9500, lng: -3.1900 },
  { id: 'grassmarket', label: 'Grassmarket', lat: 55.9477, lng: -3.1955 },
  { id: 'stockbridge', label: 'Stockbridge', lat: 55.9580, lng: -3.2080 },
  { id: 'leith', label: 'Leith', lat: 55.9750, lng: -3.1720 }
];

function haversine(lat1, lng1, lat2, lng2) {
  const R = 6371000;
  const toRad = d => d * Math.PI / 180;
  const dLat = toRad(lat2 - lat1), dLng = toRad(lng2 - lng1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLng/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function geolocateMe(btn) {
  if (!navigator.geolocation) { btn.textContent = '‚ùå GPS indisponible'; return; }
  btn.textContent = 'üìç Localisation...';
  btn.classList.add('loading');
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude: lat, longitude: lng } = pos.coords;
      let closest = GEO_ZONES[0], minDist = Infinity;
      GEO_ZONES.forEach(z => {
        const d = haversine(lat, lng, z.lat, z.lng);
        if (d < minDist) { minDist = d; closest = z; }
      });
      // If very far from all zones (>2km), send raw coords to AI
      if (minDist > 2000) {
        qfState.context.location = `GPS: ${lat.toFixed(4)},${lng.toFixed(4)} (√† ${Math.round(minDist)}m du quartier le plus proche: ${closest.label})`;
      } else {
        qfState.context.location = closest.id;
      }
      // Update UI: deselect all, highlight the matched zone
      btn.closest('.qf-options').querySelectorAll('.qf-opt').forEach(b => b.classList.remove('active'));
      const matchBtn = btn.closest('.qf-options').querySelector(`[data-value="${closest.id}"]`);
      if (matchBtn) matchBtn.classList.add('active');
      btn.classList.remove('loading');
      btn.classList.add('active');
      btn.textContent = `üìç ${closest.label} (~${minDist < 1000 ? Math.round(minDist) + 'm' : (minDist/1000).toFixed(1) + 'km'})`;
    },
    (err) => {
      btn.classList.remove('loading');
      btn.textContent = '‚ùå GPS refus√©';
      setTimeout(() => { btn.textContent = 'üìç Me localiser'; }, 2000);
    },
    { enableHighAccuracy: true, timeout: 8000 }
  );
}

// ===== LEAFLET MAPS =====
const HOTEL_COORDS = [55.9533, -3.1955];

const PLACE_COORDS = {
  'Urban Angel': [55.9547, -3.1958], 'Newtown Fox': [55.9560, -3.1925], 'The Cambridge Bar': [55.9538, -3.2010],
  'Caf√© St Honor√©': [55.9542, -3.2035], 'Chaophraya': [55.9522, -3.2020], 'The Piemaker': [55.9492, -3.1878],
  'Civerinos': [55.9503, -3.1882], 'Vittoria': [55.9488, -3.1920], "Bertie's Fish & Chips": [55.9489, -3.1946],
  'Mums Great Comfort Food': [55.9468, -3.1917], 'Bread Meats Bread': [55.9493, -3.2055],
  "L'Alba D'Oro": [55.9580, -3.2010], 'The Last Drop': [55.9474, -3.1955], "Mary's Milk Bar": [55.9477, -3.1970],
  'The Pantry': [55.9585, -3.2085], 'Cannonball Restaurant': [55.9491, -3.1968],
  'The Scran & Scallie': [55.9612, -3.2150], "Loudon's Cafe & Bakery": [55.9443, -3.2120],
  'La Favorita': [55.9655, -3.1730], 'Little Foxes Play Cafe': [55.9275, -3.2060],
  'National Museum of Scotland': [55.9470, -3.1893], 'Dynamic Earth': [55.9510, -3.1744],
  'Camera Obscura & World of Illusions': [55.9498, -3.1985], 'Camera Obscura': [55.9498, -3.1985],
  'The Vennel': [55.9469, -3.1960], 'Greyfriars Bobby': [55.9468, -3.1910], 'Museum of Childhood': [55.9504, -3.1865],
  'Edinburgh Butterfly & Insect World': [55.8785, -3.1385], 'Royal Yacht Britannia': [55.9820, -3.1770],
  'Palace of Holyroodhouse': [55.9527, -3.1718], 'Scottish Storytelling Centre': [55.9510, -3.1850],
  'Playtown Edinburgh': [55.9818, -3.1775], 'Clambers (Royal Commonwealth Pool)': [55.9400, -3.1760],
  'Bookbug Session (Biblioth√®que Centrale)': [55.9482, -3.1920], 'Edinburgh Castle': [55.9486, -3.1999],
  'Edinburgh Zoo': [55.9425, -3.2685], 'Princes Street Gardens & Playground': [55.9510, -3.2000],
  'Princes Street Gardens': [55.9510, -3.2000], 'Royal Botanic Garden': [55.9650, -3.2090],
  'Gorgie City Farm': [55.9385, -3.2380], "Holyrood Park & St Margaret's Loch": [55.9445, -3.1620],
  'Holyrood Park & Loch': [55.9445, -3.1620], 'Portobello Beach': [55.9530, -3.1140],
  'Toddler Splash (Royal Commonwealth Pool)': [55.9400, -3.1760],
  'Victoria Street & Grassmarket': [55.9484, -3.1948], 'Royal Mile & Closes': [55.9505, -3.1895],
  'Calton Hill': [55.9548, -3.1825], 'Stockbridge': [55.9580, -3.2080],
  'Dean Village & Water of Leith': [55.9530, -3.2170], 'Dean Village': [55.9530, -3.2170],
  'Gallery of Modern Art + Sculpture Park': [55.9520, -3.2190],
  'Water of Leith Walkway': [55.9540, -3.2170], 'Old Town Discovery': [55.9500, -3.1900],
  'New Town Architecture Walk': [55.9535, -3.2070], 'Dean Village Loop': [55.9530, -3.2170],
  'Calton Hill Sunset Walk': [55.9548, -3.1825], 'Stockbridge & Circus Lane': [55.9580, -3.2080],
  'Mums': [55.9468, -3.1917], 'Bertie\'s': [55.9489, -3.1946]
};

const CLIENT_DB = {
  manger: [
    { nom: 'Urban Angel', lat: 55.9547, lng: -3.1958, short: 'Brunch bio, healthy', budget: '‚Ç¨‚Ç¨' },
    { nom: 'Newtown Fox', lat: 55.9560, lng: -3.1925, short: 'Caf√©-resto brunch all-day', budget: '‚Ç¨‚Ç¨' },
    { nom: 'The Cambridge Bar', lat: 55.9538, lng: -3.2010, short: 'Burgers pub', budget: '‚Ç¨‚Ç¨' },
    { nom: 'Caf√© St Honor√©', lat: 55.9542, lng: -3.2035, short: 'Bistrot fran√ßais', budget: '‚Ç¨‚Ç¨‚Ç¨' },
    { nom: 'Chaophraya', lat: 55.9522, lng: -3.2020, short: 'Tha√Ø rooftop, anniversaire', budget: '‚Ç¨‚Ç¨‚Ç¨‚Ç¨' },
    { nom: 'The Piemaker', lat: 55.9492, lng: -3.1878, short: 'Pies √©cossaises ¬£4‚Äì7', budget: '‚Ç¨' },
    { nom: 'Civerinos', lat: 55.9503, lng: -3.1882, short: 'Pizza NY √† la part', budget: '‚Ç¨' },
    { nom: 'Vittoria', lat: 55.9488, lng: -3.1920, short: 'Trattoria italienne familiale', budget: '‚Ç¨‚Ç¨' },
    { nom: "Bertie's Fish & Chips", lat: 55.9489, lng: -3.1946, short: 'Fish & chips authentique', budget: '‚Ç¨' },
    { nom: 'Mums Great Comfort Food', lat: 55.9468, lng: -3.1917, short: 'Comfort food, z√©ro chichi', budget: '‚Ç¨‚Ç¨' },
    { nom: 'Bread Meats Bread', lat: 55.9493, lng: -3.2055, short: 'Smash burgers cultes', budget: '‚Ç¨‚Ç¨' },
    { nom: "L'Alba D'Oro", lat: 55.9580, lng: -3.2010, short: 'Chippy italo-√©cossais', budget: '‚Ç¨' },
    { nom: 'The Last Drop', lat: 55.9474, lng: -3.1955, short: 'Pub √©cossais, Grassmarket', budget: '‚Ç¨‚Ç¨' },
    { nom: "Mary's Milk Bar", lat: 55.9477, lng: -3.1970, short: 'Gelato + hot chocolate', budget: '‚Ç¨' },
    { nom: 'The Pantry', lat: 55.9585, lng: -3.2085, short: 'Brunch Stockbridge', budget: '‚Ç¨‚Ç¨' },
    { nom: 'Cannonball Restaurant', lat: 55.9491, lng: -3.1968, short: '√âcossais, vue ch√¢teau', budget: '‚Ç¨‚Ç¨‚Ç¨' },
    { nom: 'The Scran & Scallie', lat: 55.9612, lng: -3.2150, short: 'Gastropub + salle de jeux', budget: '‚Ç¨‚Ç¨‚Ç¨' },
    { nom: "Loudon's Cafe & Bakery", lat: 55.9443, lng: -3.2120, short: 'Brunch + aire de jeux', budget: '‚Ç¨‚Ç¨' },
    { nom: 'La Favorita', lat: 55.9655, lng: -3.1730, short: 'Pizza napolitaine feu de bois', budget: '‚Ç¨‚Ç¨' },
    { nom: 'Little Foxes Play Cafe', lat: 55.9275, lng: -3.2060, short: 'Caf√© + soft play 0‚Äì4 ans', budget: '‚Ç¨' }
  ],
  activite: [
    { nom: 'National Museum of Scotland', lat: 55.9470, lng: -3.1893, short: 'Mus√©e gratuit, galerie toddler', prix: 'Gratuit' },
    { nom: 'Dynamic Earth', lat: 55.9510, lng: -3.1744, short: 'Volcans 4D, for√™t tropicale', prix: '¬£17.50' },
    { nom: 'Camera Obscura', lat: 55.9498, lng: -3.1985, short: 'Illusions, miroirs, lumi√®res', prix: '¬£19.50' },
    { nom: 'The Vennel Viewpoint', lat: 55.9469, lng: -3.1960, short: 'Vue iconique sur le ch√¢teau', prix: 'Gratuit' },
    { nom: 'Museum of Childhood', lat: 55.9504, lng: -3.1865, short: 'Jouets historiques', prix: 'Gratuit' },
    { nom: 'Butterfly World', lat: 55.8785, lng: -3.1385, short: 'Serre tropicale, papillons', prix: '¬£7.95' },
    { nom: 'Royal Yacht Britannia', lat: 55.9820, lng: -3.1770, short: 'Yacht royal √† explorer', prix: '¬£18.50' },
    { nom: 'Edinburgh Castle', lat: 55.9486, lng: -3.1999, short: 'Ch√¢teau, joyaux, vue', prix: '¬£19.50' },
    { nom: 'Edinburgh Zoo', lat: 55.9425, lng: -3.2685, short: 'Zoo, parade manchots 14h15', prix: '¬£20' },
    { nom: 'Princes St Gardens', lat: 55.9510, lng: -3.2000, short: 'Playground + vue ch√¢teau', prix: 'Gratuit' },
    { nom: 'Royal Botanic Garden', lat: 55.9650, lng: -3.2090, short: 'Serres tropicales, playground', prix: 'Gratuit' },
    { nom: 'Gorgie City Farm', lat: 55.9385, lng: -3.2380, short: 'Ferme en ville, animaux', prix: 'Gratuit' },
    { nom: 'Little Foxes Play Cafe', lat: 55.9275, lng: -3.2060, short: 'Soft play 0‚Äì4 ans', prix: '¬£6' },
    { nom: 'Playtown Edinburgh', lat: 55.9818, lng: -3.1775, short: 'Soft play g√©ant + Toddler Town', prix: '¬£7‚Äì9' },
    { nom: 'Portobello Beach', lat: 55.9530, lng: -3.1140, short: 'Plage de sable', prix: 'Gratuit' },
    { nom: 'Calton Hill', lat: 55.9548, lng: -3.1825, short: 'Vue 360¬∞ panoramique', prix: 'Gratuit' },
    { nom: 'Victoria Street', lat: 55.9484, lng: -3.1948, short: 'Rue color√©e Harry Potter', prix: 'Gratuit' },
    { nom: 'Holyrood Park', lat: 55.9445, lng: -3.1620, short: 'Loch, canards, nature', prix: 'Gratuit' }
  ],
  balade: [
    { nom: 'Princes Street Gardens', lat: 55.9510, lng: -3.2000, short: 'Vue ch√¢teau, plat', duree: '20‚Äì30 min' },
    { nom: 'Water of Leith', lat: 55.9540, lng: -3.2170, short: 'Rivi√®re, Dean Village', duree: '45min‚Äì1h' },
    { nom: 'Old Town Discovery', lat: 55.9500, lng: -3.1900, short: 'Royal Mile, closes', duree: '1h‚Äì1h30' },
    { nom: 'New Town Walk', lat: 55.9535, lng: -3.2070, short: 'Architecture g√©orgienne', duree: '45 min' },
    { nom: 'Dean Village Loop', lat: 55.9530, lng: -3.2170, short: 'Village de meuniers', duree: '45min‚Äì1h' },
    { nom: 'Calton Hill Sunset', lat: 55.9548, lng: -3.1825, short: 'Panorama coucher de soleil', duree: '30‚Äì40 min' },
    { nom: 'Stockbridge & Circus Lane', lat: 55.9580, lng: -3.2080, short: 'Boh√®me, instagrammable', duree: '1h' },
    { nom: 'Royal Botanic Garden', lat: 55.9650, lng: -3.2090, short: 'Serres, √©cureuils', duree: '1h‚Äì1h30' },
    { nom: 'Portobello Beach', lat: 55.9530, lng: -3.1140, short: 'Plage, promenade', duree: '1h' },
    { nom: 'Holyrood Park & Loch', lat: 55.9445, lng: -3.1620, short: 'Canards, cygnes', duree: '45 min' }
  ]
};

function makeIcon(html, size) {
  return L.divIcon({ html: html, className: 'custom-pin', iconSize: [size, size], iconAnchor: [size/2, size], popupAnchor: [0, -size] });
}

function getNavButton(name, address) {
  let url;
  if (name) url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name + ', Edinburgh')}`;
  else if (address) url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address + ', Edinburgh')}`;
  else return '';
  return `<a href="${url}" target="_blank" rel="noopener" class="yaller-btn" onclick="event.stopPropagation()">üß≠ Y aller</a>`;
}

// === QF Map ===
let qfMapInstance = null;

function initQFMap(suggestions) {
  const mapEl = document.getElementById('qfMap');
  if (!mapEl) return;
  if (qfMapInstance) { qfMapInstance.remove(); qfMapInstance = null; }

  qfMapInstance = L.map('qfMap', {
    zoomControl: false, dragging: !L.Browser.mobile, tap: false, touchZoom: true, scrollWheelZoom: false
  });
  L.control.zoom({ position: 'bottomright' }).addTo(qfMapInstance);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19, attribution: '&copy; OSM &copy; Carto'
  }).addTo(qfMapInstance);

  L.marker(HOTEL_COORDS, { icon: makeIcon('<div class="map-pin map-pin-hotel">üè®</div>', 44) })
    .addTo(qfMapInstance).bindPopup('<strong>üè® Notre h√¥tel</strong><br>4 & 18 Hanover Street');

  const bounds = L.latLngBounds([HOTEL_COORDS]);

  suggestions.forEach((s, i) => {
    const coords = PLACE_COORDS[s.nom];
    if (!coords) return;
    const marker = L.marker(coords, { icon: makeIcon(`<div class="map-pin map-pin-suggestion">${i+1}</div>`, 38) }).addTo(qfMapInstance);
    const navUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.nom + ', Edinburgh')}`;
    marker.bindPopup(`<div class="map-popup"><strong>${s.emoji||''} ${s.nom}</strong><p>${s.badge||''}</p><a href="${navUrl}" target="_blank" class="map-popup-nav">üß≠ Y aller</a></div>`);
    marker.on('click', () => highlightSuggestionCard(i));
    bounds.extend(coords);
  });

  qfMapInstance.fitBounds(bounds, { padding: [40, 40], maxZoom: 16 });
  setTimeout(() => qfMapInstance.invalidateSize(), 400);
}

function highlightSuggestionCard(index) {
  document.querySelectorAll('.qf-suggestion').forEach((card, i) => {
    card.style.boxShadow = i === index ? '0 0 0 3px var(--gold), 0 4px 20px rgba(0,0,0,0.15)' : '';
    if (i === index) card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
}

function panToSuggestion(index) {
  const cards = document.querySelectorAll('.qf-suggestion');
  const nameEl = cards[index]?.querySelector('.qf-sug-name');
  if (!nameEl || !qfMapInstance) return;
  const coords = PLACE_COORDS[nameEl.textContent.trim()];
  if (coords) qfMapInstance.setView(coords, 17, { animate: true });
}

// === Voir d'autres ===
let altMarkers = [];
function showAlternatives(mode, currentName, event) {
  event.stopPropagation();
  if (!qfMapInstance) return;
  altMarkers.forEach(m => qfMapInstance.removeLayer(m));
  altMarkers = [];
  const items = CLIENT_DB[mode] || [];
  const bounds = L.latLngBounds([HOTEL_COORDS]);
  items.forEach(item => {
    if (item.nom === currentName || !item.lat) return;
    const marker = L.marker([item.lat, item.lng], { icon: makeIcon('<div class="map-pin map-pin-alt">+</div>', 28) }).addTo(qfMapInstance);
    const navUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nom + ', Edinburgh')}`;
    marker.bindPopup(`<div class="map-popup"><strong>${item.nom}</strong><p>${item.short}</p><a href="${navUrl}" target="_blank" class="map-popup-nav">üß≠ Y aller</a></div>`);
    altMarkers.push(marker);
    bounds.extend([item.lat, item.lng]);
  });
  qfMapInstance.fitBounds(bounds, { padding: [30, 30], maxZoom: 15 });
}

// === Hotel Map ===
function initHotelMap() {
  const mapEl = document.getElementById('hotelMap');
  if (!mapEl || mapEl._leaflet_id) return;
  const map = L.map('hotelMap', { zoomControl: true }).setView(HOTEL_COORDS, 15);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19, attribution: '&copy; OSM &copy; Carto'
  }).addTo(map);
  L.marker(HOTEL_COORDS, { icon: makeIcon('<div class="map-pin map-pin-hotel">üè®</div>', 44) }).addTo(map)
    .bindPopup('<strong>üè® Destiny Scotland</strong><br>4 & 18 Hanover Street');
  const landmarks = [
    { n: 'Edinburgh Castle', e: 'üè∞', c: [55.9486, -3.1999] },
    { n: 'Royal Mile', e: 'üõ§Ô∏è', c: [55.9505, -3.1895] },
    { n: 'Princes St Gardens', e: 'üå≥', c: [55.9510, -3.2000] },
    { n: 'The Vennel', e: 'üì∏', c: [55.9469, -3.1960] },
    { n: 'Greyfriars Bobby', e: 'üêï', c: [55.9468, -3.1910] },
    { n: 'National Museum', e: 'üèõÔ∏è', c: [55.9470, -3.1893] },
    { n: 'St Andrew Sq Tram', e: 'üöã', c: [55.9545, -3.1910] },
    { n: 'Dean Village', e: 'üèòÔ∏è', c: [55.9530, -3.2170] }
  ];
  landmarks.forEach(lm => {
    L.marker(lm.c, { icon: makeIcon(`<div class="map-pin map-pin-landmark">${lm.e}</div>`, 36) }).addTo(map)
      .bindPopup(`<strong>${lm.n}</strong>`);
  });
  L.circle(HOTEL_COORDS, { radius: 400, color: '#c9a84c', fillOpacity: 0.04, weight: 1, dashArray: '4 6' }).addTo(map);
  L.circle(HOTEL_COORDS, { radius: 800, color: '#c9a84c', fillOpacity: 0.02, weight: 1, dashArray: '4 6' }).addTo(map);
}

const hotelMapObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) { initHotelMap(); hotelMapObserver.disconnect(); }
  });
}, { threshold: 0.1 });
const hotelMapEl = document.getElementById('hotelMap');
if (hotelMapEl) hotelMapObserver.observe(hotelMapEl);

// === Day Maps ===
const DAY_MAPS = {
  2: [
    { n: 'Edinburgh Castle', e: 'üè∞', c: [55.9486, -3.1999] },
    { n: "Bertie's Fish & Chips", e: 'üçü', c: [55.9489, -3.1946] },
    { n: 'Victoria Street & Royal Mile', e: 'üåà', c: [55.9489, -3.1948] },
    { n: 'Sieste h√¥tel', e: 'üò¥', c: [55.9533, -3.1955] },
    { n: 'Vittoria', e: 'üçù', c: [55.9488, -3.1920] }
  ],
  3: [
    { n: 'Dean Village', e: 'üèòÔ∏è', c: [55.9530, -3.2170] },
    { n: 'Holyrood Park', e: 'ü¶Ü', c: [55.9445, -3.1620] },
    { n: 'Camera Obscura', e: 'üîÆ', c: [55.9498, -3.1985] },
    { n: 'Scran & Scallie', e: 'üçΩÔ∏è', c: [55.9612, -3.2150] },
    { n: 'Sieste h√¥tel', e: 'üò¥', c: [55.9533, -3.1955] },
    { n: 'The Vennel (vue ch√¢teau)', e: 'üì∏', c: [55.9469, -3.1960] },
    { n: 'Victoria Street', e: 'üåà', c: [55.9489, -3.1948] },
    { n: 'Greyfriars Bobby', e: 'üêï', c: [55.9468, -3.1910] },
    { n: 'Grassmarket', e: 'üèòÔ∏è', c: [55.9474, -3.1955] },
    { n: 'Princes Street', e: 'üåÖ', c: [55.9520, -3.1980] }
  ],
  4: [
    { n: 'National Museum', e: 'üèõÔ∏è', c: [55.9470, -3.1893] },
    { n: 'D√©jeuner Old Town', e: 'üçΩÔ∏è', c: [55.9475, -3.1900] },
    { n: 'Princes St Gardens', e: 'üå≥', c: [55.9510, -3.2000] },
    { n: 'Calton Hill', e: '‚õ∞Ô∏è', c: [55.9548, -3.1825] },
    { n: 'D√Æner', e: 'üç¥', c: [55.9468, -3.1917] }
  ],
  5: [
    { n: 'Royal Botanic Garden', e: 'üåø', c: [55.9650, -3.2090] },
    { n: 'Museum of Childhood', e: 'üß∏', c: [55.9504, -3.1865] },
    { n: 'Shopping George St', e: 'üõçÔ∏è', c: [55.9535, -3.2020] },
    { n: 'Chaophraya', e: 'üéÇ', c: [55.9522, -3.2020] }
  ]
};

function initDayMap(dayNum) {
  const mapEl = document.getElementById('dayMap' + dayNum);
  if (!mapEl || mapEl._leaflet_id) return;
  const stops = DAY_MAPS[dayNum];
  if (!stops) return;
  const map = L.map('dayMap' + dayNum, { zoomControl: false }).setView([55.9510, -3.1960], 15);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19, attribution: '&copy; OSM &copy; Carto'
  }).addTo(map);
  const bounds = L.latLngBounds([HOTEL_COORDS]);
  L.marker(HOTEL_COORDS, { icon: makeIcon('<div class="map-pin map-pin-hotel">üè®</div>', 44) }).addTo(map);
  stops.forEach((stop, i) => {
    L.marker(stop.c, { icon: makeIcon(`<div class="map-pin map-pin-day">${i+1}</div>`, 34) }).addTo(map)
      .bindPopup(`<strong>${stop.e} ${stop.n}</strong>`);
    bounds.extend(stop.c);
  });
  const routeCoords = [HOTEL_COORDS, ...stops.map(s => s.c)];
  L.polyline(routeCoords, { color: '#2d3561', weight: 2, opacity: 0.4, dashArray: '6 8' }).addTo(map);
  map.fitBounds(bounds, { padding: [30, 30] });
  setTimeout(() => map.invalidateSize(), 400);
}

// ===== EXPLORER TOOL =====
const EXPLORER_POIS = [
  // Culture
  { id:'castle', nom:'Edinburgh Castle', cat:'culture', emoji:'üè∞', desc:'Ch√¢teau embl√©matique, Joyaux de la Couronne, vue panoramique', lat:55.9486, lng:-3.1999, prix:'¬£19.50', indoor:true, baby:'ok', duree:'1h30‚Äì2h' },
  { id:'national-museum', nom:'National Museum of Scotland', cat:'culture', emoji:'üèõÔ∏è', desc:'Dinosaures, sciences interactives, galerie Imagine pour toddlers', lat:55.9470, lng:-3.1893, prix:'Gratuit', indoor:true, baby:'top', duree:'1h30‚Äì2h' },
  { id:'camera-obscura', nom:'Camera Obscura & World of Illusions', cat:'culture', emoji:'üîÆ', desc:'Illusions d\'optique, miroirs d√©formants, magie ‚Äî super interactif', lat:55.9498, lng:-3.1985, prix:'¬£19.50', indoor:true, baby:'ok', duree:'1h‚Äì1h30' },
  { id:'the-vennel', nom:'The Vennel Viewpoint', cat:'balade', emoji:'üì∏', desc:'Escalier en pierre avec LA vue iconique sur le ch√¢teau ‚Äî LE spot photo', lat:55.9469, lng:-3.1960, prix:'Gratuit', indoor:false, baby:'top', duree:'15min' },
  { id:'greyfriars-bobby', nom:'Greyfriars Bobby', cat:'balade', emoji:'üêï', desc:'Statue du petit chien fid√®le + cimeti√®re magnifique et paisible', lat:55.9468, lng:-3.1910, prix:'Gratuit', indoor:false, baby:'top', duree:'15min' },
  { id:'museum-childhood', nom:'Museum of Childhood', cat:'culture', emoji:'üß∏', desc:'Jouets anciens et modernes, poup√©es, trains miniatures', lat:55.9504, lng:-3.1865, prix:'Gratuit', indoor:true, baby:'top', duree:'45min‚Äì1h' },
  { id:'holyroodhouse', nom:'Palace of Holyroodhouse', cat:'culture', emoji:'üëë', desc:'R√©sidence royale, espace famille avec d√©guisements', lat:55.9527, lng:-3.1718, prix:'¬£18', indoor:true, baby:'ok', duree:'1h‚Äì1h30' },
  { id:'britannia', nom:'Royal Yacht Britannia', cat:'culture', emoji:'üö¢', desc:'Yacht royal √† explorer, audio-guide famille', lat:55.9820, lng:-3.1770, prix:'¬£18.50', indoor:true, baby:'ok', duree:'1h30' },
  { id:'storytelling', nom:'Scottish Storytelling Centre', cat:'culture', emoji:'üìñ', desc:'Contes et histoires √©cossaises, sessions pour enfants', lat:55.9510, lng:-3.1850, prix:'Gratuit', indoor:true, baby:'ok', duree:'30min‚Äì1h' },
  { id:'mod-art', nom:'Gallery of Modern Art', cat:'culture', emoji:'üé®', desc:'Art moderne + parc de sculptures en plein air', lat:55.9520, lng:-3.2190, prix:'Gratuit', indoor:true, baby:'ok', duree:'1h' },
  // Nature
  { id:'botanic', nom:'Royal Botanic Garden', cat:'nature', emoji:'üåø', desc:'Serres tropicales, √©cureuils, pelouses, aire de jeux', lat:55.9650, lng:-3.2090, prix:'Gratuit', indoor:false, baby:'top', duree:'1h30‚Äì2h' },
  { id:'princes-gardens', nom:'Princes Street Gardens', cat:'nature', emoji:'üå≥', desc:'Parc avec vue ch√¢teau, playground c√¥t√© ouest', lat:55.9510, lng:-3.2000, prix:'Gratuit', indoor:false, baby:'top', duree:'1h' },
  { id:'holyrood-park', nom:'Holyrood Park & St Margaret\'s Loch', cat:'nature', emoji:'ü¶Ü', desc:'Canards, cygnes, nature sauvage au c≈ìur de la ville', lat:55.9445, lng:-3.1620, prix:'Gratuit', indoor:false, baby:'ok', duree:'1h' },
  { id:'calton', nom:'Calton Hill', cat:'nature', emoji:'‚õ∞Ô∏è', desc:'Vue 360¬∞ panoramique, mont√©e courte (~10 min), sunset', lat:55.9548, lng:-3.1825, prix:'Gratuit', indoor:false, baby:'ok', duree:'30‚Äì45min' },
  { id:'dean', nom:'Dean Village', cat:'nature', emoji:'üèòÔ∏è', desc:'Village de meuniers au bord de la rivi√®re, hors du temps', lat:55.9530, lng:-3.2170, prix:'Gratuit', indoor:false, baby:'ok', duree:'30min‚Äì1h' },
  { id:'portobello', nom:'Portobello Beach', cat:'nature', emoji:'üèñÔ∏è', desc:'Plage de sable, promenade, caf√©s sur le front de mer', lat:55.9530, lng:-3.1140, prix:'Gratuit', indoor:false, baby:'ok', duree:'1h‚Äì2h' },
  { id:'gorgie', nom:'Gorgie City Farm', cat:'nature', emoji:'üêë', desc:'Ferme gratuite en ville : moutons, cochons, poules, lapins', lat:55.9385, lng:-3.2380, prix:'Gratuit', indoor:false, baby:'top', duree:'1h' },
  { id:'water-leith', nom:'Water of Leith Walkway', cat:'nature', emoji:'üåä', desc:'Rivi√®re en ville, balade plate praticable en poussette', lat:55.9540, lng:-3.2170, prix:'Gratuit', indoor:false, baby:'ok', duree:'45min‚Äì1h' },
  // Jeux
  { id:'little-foxes', nom:'Little Foxes Play Cafe', cat:'jeux', emoji:'ü¶ä', desc:'Soft play d√©di√© 0‚Äì4 ans + caf√© pour les parents', lat:55.9275, lng:-3.2060, prix:'¬£6', indoor:true, baby:'top', duree:'1h‚Äì1h30' },
  { id:'playtown', nom:'Playtown Edinburgh', cat:'jeux', emoji:'üé™', desc:'Soft play g√©ant avec zone Toddler Town d√©di√©e aux petits', lat:55.9818, lng:-3.1775, prix:'¬£7‚Äì9', indoor:true, baby:'top', duree:'1h30‚Äì2h' },
  { id:'clambers', nom:'Clambers (Commonwealth Pool)', cat:'jeux', emoji:'üßó', desc:'Aire de jeux indoor au Royal Commonwealth Pool', lat:55.9400, lng:-3.1760, prix:'¬£5', indoor:true, baby:'ok', duree:'1h' },
  { id:'butterfly', nom:'Edinburgh Butterfly & Insect World', cat:'jeux', emoji:'ü¶ã', desc:'Serre tropicale, papillons en libert√© ‚Äî magique pour les petits', lat:55.8785, lng:-3.1385, prix:'¬£7.95', indoor:true, baby:'top', duree:'1h' },
  { id:'bookbug', nom:'Bookbug (Biblioth√®que Centrale)', cat:'jeux', emoji:'üìö', desc:'Session gratuite de chansons et histoires pour b√©b√©s/toddlers', lat:55.9482, lng:-3.1920, prix:'Gratuit', indoor:true, baby:'top', duree:'30min' },
  { id:'toddler-splash', nom:'Toddler Splash (Commonwealth Pool)', cat:'jeux', emoji:'üèä', desc:'Session piscine d√©di√©e aux tout-petits, eau chaude', lat:55.9400, lng:-3.1760, prix:'¬£4', indoor:true, baby:'top', duree:'45min' },
  // Manger
  { id:'urban-angel', nom:'Urban Angel', cat:'manger', emoji:'ü•ë', desc:'Brunch bio et healthy, avocado toast, smoothies', lat:55.9547, lng:-3.1958, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'scran', nom:'The Scran & Scallie', cat:'manger', emoji:'üçΩÔ∏è', desc:'Gastropub du chef Tom Kitchin + salle de jeux enfants', lat:55.9612, lng:-3.2150, prix:'‚Ç¨‚Ç¨‚Ç¨', indoor:true, baby:'top' },
  { id:'vittoria', nom:'Vittoria', cat:'manger', emoji:'üçù', desc:'Trattoria italienne familiale, menu kids, crayons', lat:55.9488, lng:-3.1920, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'top' },
  { id:'berties', nom:"Bertie's Fish & Chips", cat:'manger', emoji:'üçü', desc:'Fish & chips authentique sur Victoria Street', lat:55.9489, lng:-3.1946, prix:'‚Ç¨', indoor:true, baby:'ok' },
  { id:'mums', nom:'Mums Great Comfort Food', cat:'manger', emoji:'ü•ß', desc:'Saucisses-pur√©e, mac & cheese, haggis ‚Äî z√©ro chichi', lat:55.9468, lng:-3.1917, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'chaophraya', nom:'Chaophraya', cat:'manger', emoji:'ü•¢', desc:'Rooftop tha√Ø, vue ch√¢teau illumin√©, cuisine raffin√©e', lat:55.9522, lng:-3.2020, prix:'‚Ç¨‚Ç¨‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'piemaker', nom:'The Piemaker', cat:'manger', emoji:'ü•ß', desc:'Pies √©cossaises maison ¬£4‚Äì7', lat:55.9492, lng:-3.1878, prix:'‚Ç¨', indoor:true, baby:'ok' },
  { id:'civerinos', nom:'Civerinos', cat:'manger', emoji:'üçï', desc:'Pizza New York √† la part, rapide et bon', lat:55.9503, lng:-3.1882, prix:'‚Ç¨', indoor:true, baby:'ok' },
  { id:'cambridge', nom:'The Cambridge Bar', cat:'manger', emoji:'üçî', desc:'Burgers de qualit√© dans un pub victorien', lat:55.9538, lng:-3.2010, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'st-honore', nom:'Caf√© St Honor√©', cat:'manger', emoji:'ü•ê', desc:'Bistrot fran√ßais, cuisine saisonni√®re √©cossaise', lat:55.9542, lng:-3.2035, prix:'‚Ç¨‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'bmb', nom:'Bread Meats Bread', cat:'manger', emoji:'üçî', desc:'Smash burgers cultes, frites maison', lat:55.9493, lng:-3.2055, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'alba', nom:"L'Alba D'Oro", cat:'manger', emoji:'üêü', desc:'Chippy italo-√©cossais, portions g√©n√©reuses', lat:55.9580, lng:-3.2010, prix:'‚Ç¨', indoor:true, baby:'ok' },
  { id:'last-drop', nom:'The Last Drop', cat:'manger', emoji:'üç∫', desc:'Pub √©cossais historique sur Grassmarket', lat:55.9474, lng:-3.1955, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'marys', nom:"Mary's Milk Bar", cat:'manger', emoji:'üç¶', desc:'Gelato artisanal + hot chocolate, Grassmarket', lat:55.9477, lng:-3.1970, prix:'‚Ç¨', indoor:true, baby:'top' },
  { id:'pantry', nom:'The Pantry', cat:'manger', emoji:'ü•û', desc:'Brunch cozy √† Stockbridge, pancakes', lat:55.9585, lng:-3.2085, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'cannonball', nom:'Cannonball Restaurant', cat:'manger', emoji:'üè¥', desc:'Cuisine √©cossaise avec vue directe sur le ch√¢teau', lat:55.9491, lng:-3.1968, prix:'‚Ç¨‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'loudons', nom:"Loudon's Cafe & Bakery", cat:'manger', emoji:'‚òï', desc:'Caf√©-boulangerie avec aire de jeux enfants', lat:55.9443, lng:-3.2120, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'top' },
  { id:'la-favorita', nom:'La Favorita', cat:'manger', emoji:'üçï', desc:'Pizza napolitaine au feu de bois, Leith Walk', lat:55.9655, lng:-3.1730, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  { id:'newtown-fox', nom:'Newtown Fox', cat:'manger', emoji:'ü¶ä', desc:'Caf√©-resto brunch all-day, d√©contract√©', lat:55.9560, lng:-3.1925, prix:'‚Ç¨‚Ç¨', indoor:true, baby:'ok' },
  // Shopping
  { id:'victoria-st', nom:'Victoria Street', cat:'shopping', emoji:'üåà', desc:'Rue color√©e en courbe, boutiques ind√©pendantes, Harry Potter vibes', lat:55.9489, lng:-3.1948, prix:'Gratuit', indoor:false, baby:'ok' },
  { id:'george-st', nom:'George Street', cat:'shopping', emoji:'üõçÔ∏è', desc:'Boutiques √©l√©gantes, caf√©s chics, New Town', lat:55.9535, lng:-3.2020, prix:'Gratuit', indoor:false, baby:'ok' },
  { id:'grassmarket', nom:'Grassmarket', cat:'shopping', emoji:'üè¥', desc:'Place historique, pubs, boutiques vintage, march√©s', lat:55.9474, lng:-3.1955, prix:'Gratuit', indoor:false, baby:'ok' },
  { id:'stockbridge', nom:'Stockbridge', cat:'shopping', emoji:'üé®', desc:'Quartier boh√®me, charity shops, march√© le dimanche', lat:55.9580, lng:-3.2080, prix:'Gratuit', indoor:false, baby:'ok' },
  { id:'royal-mile', nom:'Royal Mile', cat:'shopping', emoji:'üè∞', desc:'Souvenirs, whisky, tartan, shortbread, closes m√©di√©vales', lat:55.9505, lng:-3.1895, prix:'Gratuit', indoor:false, baby:'ok' },
  // Balades
  { id:'circus-lane', nom:'Circus Lane', cat:'balade', emoji:'üì∏', desc:'Petite ruelle pav√©e ultra-instagrammable √† Stockbridge', lat:55.9575, lng:-3.2085, prix:'Gratuit', indoor:false, baby:'ok', duree:'15min' },
  { id:'new-town-walk', nom:'New Town Architecture Walk', cat:'balade', emoji:'üèõÔ∏è', desc:'Architecture g√©orgienne, Charlotte Square, crescents', lat:55.9535, lng:-3.2070, prix:'Gratuit', indoor:false, baby:'ok', duree:'45min' },
  { id:'old-town-walk', nom:'Old Town Discovery', cat:'balade', emoji:'üè∞', desc:'Royal Mile, closes secr√®tes, Grassmarket, histoire', lat:55.9500, lng:-3.1900, prix:'Gratuit', indoor:false, baby:'ok', duree:'1h‚Äì1h30' },
  { id:'calton-sunset', nom:'Calton Hill Sunset Walk', cat:'balade', emoji:'üåÖ', desc:'Mont√©e douce pour un panorama magique au coucher du soleil', lat:55.9548, lng:-3.1825, prix:'Gratuit', indoor:false, baby:'ok', duree:'30‚Äì40min' },
  { id:'dean-loop', nom:'Dean Village Loop', cat:'balade', emoji:'üèòÔ∏è', desc:'Village de meuniers, rivi√®re, ponts ‚Äî parcours en boucle', lat:55.9530, lng:-3.2170, prix:'Gratuit', indoor:false, baby:'ok', duree:'45min‚Äì1h' },
  { id:'leith-walk', nom:'Leith & The Shore', cat:'balade', emoji:'‚öì', desc:'Quartier portuaire branch√©, restaurants, galeries, Royal Yacht', lat:55.9740, lng:-3.1700, prix:'Gratuit', indoor:false, baby:'ok', duree:'1h‚Äì2h' }
];

let explorerMap = null;
let explorerMarkers = [];
let explorerGpsActive = false;
let explorerUserPos = null;
let explorerUserMarker = null;
let explorerCurrentCat = 'all';
let explorerCurrentSort = 'distance';
const explorerRefPoint = { lat: HOTEL_COORDS[0], lng: HOTEL_COORDS[1] };

function haversine(lat1, lng1, lat2, lng2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLng/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function getDistanceLabel(poi) {
  const ref = explorerGpsActive && explorerUserPos ? explorerUserPos : explorerRefPoint;
  const km = haversine(ref.lat, ref.lng, poi.lat, poi.lng);
  if (km < 1) return Math.round(km * 1000) + 'm';
  return km.toFixed(1) + 'km';
}

function getDistanceKm(poi) {
  const ref = explorerGpsActive && explorerUserPos ? explorerUserPos : explorerRefPoint;
  return haversine(ref.lat, ref.lng, poi.lat, poi.lng);
}

function openExplorer() {
  document.getElementById('explorerOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
  if (!explorerMap) {
    setTimeout(() => {
      explorerMap = L.map('explorerMap', { zoomControl: false, tap: false }).setView(HOTEL_COORDS, 14);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        maxZoom: 19, attribution: '&copy; OSM &copy; Carto'
      }).addTo(explorerMap);
      L.marker(HOTEL_COORDS, { icon: makeIcon('<div class="map-pin map-pin-hotel">üè®</div>', 44) })
        .addTo(explorerMap).bindPopup('<strong>üè® Destiny Scotland</strong><br>Votre h√¥tel');
      renderExplorer();
    }, 200);
  } else {
    setTimeout(() => explorerMap.invalidateSize(), 200);
    renderExplorer();
  }
}

function closeExplorer() {
  document.getElementById('explorerOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function filterExplorer(cat, btn) {
  explorerCurrentCat = cat;
  document.querySelectorAll('.explorer-filter-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  renderExplorer();
}

function sortExplorer(mode, btn) {
  explorerCurrentSort = mode;
  document.querySelectorAll('.explorer-sort button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderExplorer();
}

function toggleExplorerGps() {
  const gpsBtn = document.getElementById('explorerGpsBtn');
  if (explorerGpsActive) {
    explorerGpsActive = false;
    gpsBtn.classList.remove('active');
    if (explorerUserMarker) { explorerMap.removeLayer(explorerUserMarker); explorerUserMarker = null; }
    renderExplorer();
    return;
  }
  gpsBtn.textContent = '‚è≥';
  navigator.geolocation.getCurrentPosition(pos => {
    explorerUserPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
    explorerGpsActive = true;
    gpsBtn.classList.add('active');
    gpsBtn.textContent = 'üìç';
    if (explorerUserMarker) explorerMap.removeLayer(explorerUserMarker);
    explorerUserMarker = L.marker([explorerUserPos.lat, explorerUserPos.lng], {
      icon: makeIcon('<div style="width:14px;height:14px;background:#4285f4;border:3px solid white;border-radius:50%;box-shadow:0 0 8px rgba(66,133,244,0.6);"></div>', 20)
    }).addTo(explorerMap).bindPopup('üìç Vous √™tes ici');
    explorerMap.panTo([explorerUserPos.lat, explorerUserPos.lng]);
    renderExplorer();
  }, () => {
    gpsBtn.textContent = 'üìç';
  }, { enableHighAccuracy: true, timeout: 8000 });
}

const CAT_COLORS = {
  culture: '#6366f1', nature: '#059669', jeux: '#ea580c',
  manger: '#dc2626', shopping: '#8b5cf6', balade: '#0891b2'
};

function renderExplorer() {
  let pois = explorerCurrentCat === 'all' ? [...EXPLORER_POIS] : EXPLORER_POIS.filter(p => p.cat === explorerCurrentCat);

  // Sort
  if (explorerCurrentSort === 'distance') {
    pois.sort((a, b) => getDistanceKm(a) - getDistanceKm(b));
  } else if (explorerCurrentSort === 'free') {
    pois.sort((a, b) => {
      const aFree = a.prix === 'Gratuit' ? 0 : 1;
      const bFree = b.prix === 'Gratuit' ? 0 : 1;
      return aFree - bFree || getDistanceKm(a) - getDistanceKm(b);
    });
  } else if (explorerCurrentSort === 'baby') {
    pois.sort((a, b) => {
      const aTop = a.baby === 'top' ? 0 : 1;
      const bTop = b.baby === 'top' ? 0 : 1;
      return aTop - bTop || getDistanceKm(a) - getDistanceKm(b);
    });
  }

  // Update count
  document.getElementById('explorerCount').textContent = pois.length + ' lieu' + (pois.length > 1 ? 'x' : '');

  // Clear markers
  explorerMarkers.forEach(m => explorerMap.removeLayer(m));
  explorerMarkers = [];

  // Add markers
  const bounds = L.latLngBounds([HOTEL_COORDS]);
  pois.forEach((poi, i) => {
    const color = CAT_COLORS[poi.cat] || '#2d3561';
    const marker = L.marker([poi.lat, poi.lng], {
      icon: makeIcon(`<div style="background:${color};color:white;width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.9rem;font-weight:700;border:3px solid white;box-shadow:0 3px 10px rgba(0,0,0,0.35);">${poi.emoji}</div>`, 34)
    }).addTo(explorerMap);
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(poi.nom + ', Edinburgh')}`;
    marker.bindPopup(`<strong>${poi.emoji} ${poi.nom}</strong><br><span style="font-size:0.8rem;color:#666">${poi.desc}</span><br><a href="${mapsUrl}" target="_blank" style="color:#3d6b4f;font-weight:600;font-size:0.8rem">üìç Google Maps</a>`);
    marker.on('click', () => {
      const card = document.getElementById('exc-' + poi.id);
      if (card) {
        document.querySelectorAll('.explorer-card').forEach(c => c.classList.remove('highlighted'));
        card.classList.add('highlighted');
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
    explorerMarkers.push(marker);
    bounds.extend([poi.lat, poi.lng]);
  });
  if (pois.length > 0) explorerMap.fitBounds(bounds, { padding: [40, 40], maxZoom: 15 });

  // Render cards
  const list = document.getElementById('explorerList');
  if (pois.length === 0) {
    list.innerHTML = '<div class="explorer-empty">Aucun lieu trouv√© dans cette cat√©gorie.</div>';
    return;
  }

  list.innerHTML = pois.map(poi => {
    const dist = getDistanceLabel(poi);
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(poi.nom + ', Edinburgh')}`;
    const isFree = poi.prix === 'Gratuit';
    let tags = '';
    if (poi.indoor) tags += '<span class="explorer-tag explorer-tag-indoor">Indoor</span>';
    else tags += '<span class="explorer-tag explorer-tag-outdoor">Outdoor</span>';
    if (isFree) tags += '<span class="explorer-tag explorer-tag-free">Gratuit</span>';
    if (poi.baby === 'top') tags += '<span class="explorer-tag explorer-tag-baby-top">Top b√©b√©</span>';
    if (poi.duree) tags += '<span class="explorer-tag" style="background:#f3f4f6;color:#6b7280">‚è±Ô∏è ' + poi.duree + '</span>';

    return `<div class="explorer-card" id="exc-${poi.id}" onclick="focusExplorerPoi('${poi.id}')">
      <div class="explorer-card-top">
        <div class="explorer-card-emoji">${poi.emoji}</div>
        <div class="explorer-card-info">
          <div class="explorer-card-name">${poi.nom}</div>
          <div class="explorer-card-desc">${poi.desc}</div>
        </div>
        <div class="explorer-card-meta">
          <div>
            <div class="explorer-card-dist">${dist}</div>
            ${!isFree ? '<div class="explorer-card-price">' + poi.prix + '</div>' : ''}
          </div>
        </div>
      </div>
      <div class="explorer-card-tags">${tags}</div>
      <div class="explorer-card-actions">
        <a href="${mapsUrl}" target="_blank" rel="noopener" class="explorer-maps-link" onclick="event.stopPropagation()">üìç Ouvrir dans Google Maps</a>
      </div>
    </div>`;
  }).join('');
}

function focusExplorerPoi(id) {
  const poi = EXPLORER_POIS.find(p => p.id === id);
  if (!poi) return;
  explorerMap.setView([poi.lat, poi.lng], 16, { animate: true });
  const markerIdx = (explorerCurrentCat === 'all' ? EXPLORER_POIS : EXPLORER_POIS.filter(p => p.cat === explorerCurrentCat)).findIndex(p => p.id === id);
  if (markerIdx >= 0 && explorerMarkers[markerIdx]) explorerMarkers[markerIdx].openPopup();
  document.querySelectorAll('.explorer-card').forEach(c => c.classList.remove('highlighted'));
  document.getElementById('exc-' + id)?.classList.add('highlighted');
}
</script>

</body>
</html>
